<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<link th:href="@{/css/student/header.css}" rel="stylesheet">
<link th:href="@{/css/student/main.css}" rel="stylesheet">
<link th:href="@{/css/student/subbar.css}" rel="stylesheet">
<link th:href="@{/css/student/mypage.css}" rel="stylesheet">
<link rel="icon" href="/img/icon.png" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<meta charset="UTF-8">
<title>main page</title>
</head>
<body>
	<div th:replace="~{/include/student_header :: header}"
		style="width: 100%;"></div>

	<div class="container">
		<div class="maintext">
			<h1 style="color: #0E5881; margin-top: 3%;">마이페이지</h1>
		</div>
		<div class="content">
			<div th:replace="~{/include/student_subbar :: subbar}"></div>
			<div class="maincontent">
				<div class="personalData">
					<h3>개인 정보 조회/수정</h3>
					<div class="passwordForm" style="text-align: center;">
						<h1 style="margin-bottom: 5%;">비밀번호 확인</h1>
						<input type="password" id="passwordInput" placeholder="비밀번호 입력">
						<button id="checkPassword">비밀번호 확인</button>
					</div>
					<div id="userInfo" style="display: none;">
						<table class="infoTable">
							<tr>
								<th>이름</th>
								<td><input type="text" id="userName"></td>
							</tr>
							<tr>
								<th>이메일</th>
								<td><div id="userEmail"></div></td>
							</tr>
							<tr>
								<th>성별</th>
								<td><input type="text" id="userGender"></td>
							</tr>
							<tr>
								<th>생년월일</th>
								<td><input type="text" id="userBirth"></td>
							</tr>
							<tr>
								<th>휴대전화</th>
								<td><input type="text" id="userTel"></td>
							</tr>
							<tr>
								<th>직업</th>
								<td><input type="text" id="userJob"></td>
							</tr>
							<tr>
								<th>가입일</th>
								<td><div id="rgstDt"></div></td>
							</tr>
							<tr>
								<th>마지막 로그인 일시</th>
								<td><div id="lastLogin"></div></td>
							</tr>
						</table>
						<div class="infoBtn">
							<button id="updateUserInfo">수정하기</button>
							<button id="withdraw">탈퇴하기</button>
						</div>
					</div>
				</div>
				<div class="applyList" style="display: none;">
					<h3>교육 과정 지원 내역</h3>
					<div>
						<table class="applyTable">
							<thead>
								<tr>
									<th>번호</th>
									<th>교육과정명</th>
									<th>지원기간</th>
									<th>교육기간</th>
									<th>정원</th>
									<th>지원날짜</th>
									<th>지원상태</th>
									<th>수정/수강</th>
								</tr>
							</thead>
							<tbody>
								<tr class="aplyRow"
									th:each="ApplyDetailDTO , rowStat : ${applyList}">
									<td><span th:text="${rowStat.index + 1}"></span></td>
									<td th:text="${ApplyDetailDTO.clssNm}"></td>
									<td
										th:text="${ApplyDetailDTO.aplyStartDd} +' ~ '+ ${ApplyDetailDTO.aplyEndDd}"></td>
									<td
										th:text="${ApplyDetailDTO.clssStartDd} +' ~ '+ ${ApplyDetailDTO.clssEndDd}"></td>
									<td th:text="${ApplyDetailDTO.limitCnt}"></td>
									<td th:text="${ApplyDetailDTO.rgstDd}"></td>
									<td th:text="${ApplyDetailDTO.cmcdNm}"></td>
									<td><button class="update">수정</button>
										<button class="apply">수강</button>
										<button class="cancel">지원취소</button>
										<button class="drop">수강포기</button></td>
									<td style="display: none;"><span
										th:text="${ApplyDetailDTO.aplyId}"></span></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="completeList" style="display: none;">
					<h3>교육 과정 이수 내역</h3>
					<div>
						<table class="rgstTable">
							<thead>
								<tr>
									<th>번호</th>
									<th>교육과정명</th>
									<th>교육기간</th>
									<th>수강상태</th>
									<th>이수상태</th>
									<th>이수증 다운로드</th>
								</tr>
							</thead>
							<tbody>
								<tr class="rgstRow"
									th:each="RegistrationVO , rowStat : ${rgstList}">
									<td><span th:text="${rowStat.index + 1}"></span></td>
									<td th:text="${RegistrationVO.clssNm}"></td>
									<td
										th:utext="${RegistrationVO.clssStartDd}+'&lt;br /&gt; ~ '+  ${RegistrationVO.clssEndDd}"></td>
									<td th:text="${RegistrationVO.rgstNm}"></td>
									<td th:text="${RegistrationVO.cmptNm}"></td>
									<td class="rgstPrint" style="display: none;"><a
										th:href="@{/download/file/__${RegistrationVO.fileId}__/__${RegistrationVO.fileSubId}__}"
										th:title="${RegistrationVO.fileNm}"> <img
											style="height: 25px;" th:src="@{/img/file_icon.png}"
											alt="file  아이콘"></a></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="workLog" style="display: none;">
					<h3>출퇴근 관리</h3>
					<div>
						<table class="wlogTable">
							<thead>
								<tr>
									<th>번호</th>
									<th>교육과정명</th>
									<th>출근시간</th>
									<th>퇴근시간</th>
									<th>출퇴근상태</th>
									<th>사유서제출</th>
									<th>사유서상태</th>
								</tr>
							</thead>
							<tbody>
								<!-- <tr class="wlogRow" th:each="WorklogVO , rowStat : ${wlogList}">
									<td><span th:text="${rowStat.index + 1}"></span></td>
									<td th:text="${WorklogVO.clssNm}"></td>
									<td th:text="${WorklogVO.inTm}"></td>
									<td th:text="${WorklogVO.outTm}"></td>
									<td th:text="${WorklogVO.wlogNm}"></td>
									<td><button class="submitResn">제출</button>
										<button class="updateResn">수정</button>
									</td>
									<td class="resnStstus"
										th:text="${WorklogVO.resnNm}"></td>
								</tr> -->
							</tbody>
						</table>
					</div>
				</div>
				<div class="modal1" style="display: none;">
					<div class="modalBody">
						<div class="modalHeader">
							<h2 class="modalTitle" style="margin: 0;">지원하기</h2>
						</div>
						<div class="modalContent">
							<div class="upload-area">
								<p>지원서파일을 여기에 첨부하세요.</p>
								<input type="file" name="file" id="fileInput1">
							</div>
						</div>
						<div class="modalFooter">
							<button type="reset" class="closeModalBtn">취소</button>
							<button type="submit" class="aplyBtn">수정하기</button>
						</div>
					</div>
				</div>
				<div class="modal2" style="display: none;">
					<div class="modalBody">
						<div class="modalHeader">
							<h2 class="modalTitle" style="margin: 0;">사유서 작성하기</h2>
						</div>
						<div class="modalContent">
							<div class="upload-area">
								<p>사유서파일을 첨부하세요.</p>
								<input type="file" name="file" id="fileInput2">
							</div>
							<div>
								<label>사유서 내용을 작성하세요.</label> <input type="text"
									class="resnText1">
							</div>
						</div>

						<div class="modalFooter">
							<button type="reset" class="closeBtn">취소</button>
							<button type="button" class="submitBtn">제출하기</button>
						</div>
					</div>
				</div>
				<div class="modal3" style="display: none;">
					<div class="modalBody">
						<div class="modalHeader">
							<h2 class="modalTitle" style="margin: 0;">사유서 작성하기</h2>
						</div>
						<div class="modalContent">
							<div class="upload-area">
								<p>사유서파일을 첨부하세요.</p>
								<input type="file" name="file" id="fileInput3">
							</div>
							<div>
								<label>사유서 내용을 작성하세요.</label> <input type="text"
									class="resnText2">
							</div>
						</div>

						<div class="modalFooter">
							<button type="reset" class="closeBtn">취소</button>
							<button type="submit" class="submitBtn">수정하기</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script th:inline="javascript">
		/* JavaScript에서 Java 모델의 값을 가져와서 처리 */
		var rgstList = /*[[${rgstList}]]*/[];

		for (var i = 0; i < rgstList.length; i++) {
			var cmptCd = rgstList[i].cmptCd;
			var rgstPrintElement = $('.rgstPrint').eq(i);

			if (cmptCd === 'CMP0000002') {
				rgstPrintElement.css('display', 'revert');
			}
		}
	</script>
	<script>
		$(document).ready(function() {
			$("#checkPassword").click(function() {
				var password = $("#passwordInput").val(); // 입력란에서 비밀번호를 가져옵니다.

				// 서버로 보낼 요청 데이터를 JSON 형식으로 생성
				var requestData = {
					password : password
				};

				// 비밀번호 확인 요청을 서버로 보냅니다.
				$.ajax({
					type : "POST",
					url : "/student/check/password",
					data : JSON.stringify(requestData), // JSON 데이터 전송
					contentType : "application/json", // 데이터 타입 설정
					success : function(data) {
						if (data.success) {
							// 비밀번호가 일치하는 경우
							displayUserInfo(data.user);
							$("#userInfo").show();
							$(".passwordForm").hide();
						} else {
							// 비밀번호가 일치하지 않는 경우
							alert("비밀번호가 일치하지 않습니다.");
						}
					},
					error : function(error) {
						console.error("오류 발생:", error);
					}
				});
			});
		});
		// 정보 업데이트 버튼을 클릭할 때 서버로 정보 업데이트 요청을 보냅니다.
		$("#updateUserInfo").click(function() {
			var updatedUserInfo = {
				name : $("#userName").val(),
				birth : $("#userBirth").val(),
				gender : $("#userGender").val(),
				tel : $("#userTel").val(),
				job : $("#userJob").val(),
			};

			// 서버로 정보 업데이트 요청을 보냅니다.
			$.ajax({
				type : "POST",
				url : "/student/updateUserInfo",
				data : JSON.stringify(updatedUserInfo),
				contentType : "application/json",
				success : function(response) {
					if (response.success) {
						alert("정보가 업데이트되었습니다.");
					} else {
						alert("정보 업데이트에 실패했습니다.");
					}
				},
				error : function(error) {
					console.error("오류 발생:", error);
				}
			});
		});

		function displayUserInfo(userInfo) {
			document.getElementById("userName").value = userInfo.name;
			document.getElementById("userEmail").textContent = userInfo.email;
			document.getElementById("userGender").value = userInfo.gender;
			document.getElementById("userBirth").value = userInfo.birth;
			document.getElementById("userTel").value = userInfo.tel;
			document.getElementById("userJob").value = userInfo.job;
			document.getElementById("rgstDt").textContent = userInfo.rgstDt;
			document.getElementById("lastLogin").textContent = userInfo.LastLogin;
		}
	</script>
	<script src="/js/student/sidebar.js"></script>
	<script src="/js/student/mypage.js"></script>
</body>
</html>