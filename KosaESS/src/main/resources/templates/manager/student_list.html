<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/include/manager_header :: header}">
<meta charset="UTF-8">
<title>Manager Student List</title>
</head>
<head>
	<link th:href="@{/css/manager/manager_student_list.css}" rel="stylesheet" />
	<link th:href="@{/css/manager/manager_class_list.css}" rel="stylesheet" />
	<link th:href="@{/css/manager/manager_post_list.css}" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
	<!-- 서브바 부분 -->
	<div th:replace="~{/include/manager_subbar_2 :: subbar}"></div>
	<!-- End 서브바 -->

	<!-- 컨텐츠 부분 -->
	<div class="home-section">
		<!-- title -->
		<div class="title_wrap">
			<span class="title" th:text="|${title} : |"></span><a class="title_a" id="className" th:if="${thisClass.clssId!=null}" th:text="${thisClass.clssNm}" th:href="@{/manager/class/__${thisClass.clssId}__}" th:value="${thisClass.clssId}"></a>
		</div>

		<!-- content wrap-->
		<div class="content_wrap">
			<div class="search_filter_wrap">
				<!-- 검색 필터 테이블 -->
				<div class="search_filter_table_wrap">
					<table class="search_filter_table" style="width: 100%;">
						<tr>
							<td style="width: 10%;">교육과정명</td>
							<td style="width: 30%;">
								<select id="classId">
									<option value="" disabled selected>교육과정명을 선택하세요</option>
									<option th:each="class:${classList}" th:text="${class.clssNm}" th:value="${class.clssId}" >
									</option>
								</select>
							</td>
							<td style="width: 10%;">기간</td>
							<td style="width: 30%;"><input type="date" id="startDate"><span> ~ </span><input type="date" id="endDate"></td>
						</tr>
					</table>
				</div>
				<!-- 검색 버튼 -->
				<div class="search_filter_btn_wrap">
					<button class="search_filter_btn" th:id="searchButton" onclick="search()">검색</button>
				</div>
				<!-- End : 검색 버튼 -->
			</div>
			<!-- End : 검색 필터 테이블-->
			
			<!-- 테이블 조작 -->
			<div class=>
				<span>
					<span th:text="${stdtCnt}" id="stdtCnt"></span><span>명</span>
				</span>
				<span th:each="cmptCodeName:${cmptCodeNameList}" class="cmpt_controller">
					<button onclick="cmptUpdate(this)" th:value="${cmptCodeName.cmcdId}" th:text="${cmptCodeName.cmcdNm}" class="cmpt_btn" th:classappend="${cmptCodeNameStat.count}"></button>
				</span>
			</div>
			<!-- End : 테이블 조작 -->
			
			<!-- table 시작 -->
			<table id="stdt_list_table">
			<thead>
				<tr id="stdt_list_table_head">
					<th><input type="checkbox" id="chkAllStdt"></th>
					<th>번호</th>
					<th>이름</th>
					<th>이메일</th>
					<th>연락처</th>
					<th>성별</th>
					<th>생년월일</th>
					<th th:each="wlogCodeName:${wlogCodeNameList}"
						th:text="${wlogCodeName.cmcdNm}"></th>
					<th>이수율</th>
					<th>이수여부</th>
				</tr>
				</thead>
				<tbody id="stdt_list_table_tbody">
				<tr th:each="stdt:${stdtList}" id="stdt_list_table_row">
					<td><input type="checkbox" id="chkStdt" name="checkedStdt" th:value="${stdt.stdtId}"></td>
					<td th:text="${stdtStat.count}"></td>
					<td th:text="${stdt.stdtNm}"></td>
					<td th:text="${stdt.userEmail}">이메일</td>
					<td th:text="${stdt.stdtTel}">연락처</td>
					<td th:text="${stdt.genderCd}">성별</td>
					<td th:text="${stdt.birthDd}">생년월일</td>
					<td th:each="wlogCodeName:${wlogCodeNameList}" th:text="${#strings.substring(#strings.setSplit(stdt.wlogCnt,',')[wlogCodeNameStat.count-1],10,)}">?</td>
					<td th:text="엄">이수율</td><!-- 구현 방법 : wlog 에서 totalTm가져오고 교육과정의 이수 시간을 가져와서 백분율을 출력 -->
					<td th:text="${stdt.jobCd}">이수여부</td>
				</tr>
				</tbody>
			</table>
			<!-- End : table 시작-->
		</div>
	</div>

<script>
var chkAll = $("#chkAllStdt");
var chkList = $("input[name=checkedStdt]");
var isChecked = chkAll.prop("checked");
var allChecked = chkList.filter(":checked").length === chkList.length;
var stdtListTable = document.getElementById('stdt_list_table_tbody');

//테이블의 모든 내용을 삭제
function clearTable(){
	if(stdtListTable.firstChild != null){
		while (stdtListTable.firstChild) {
			stdtListTable.removeChild(stdtListTable.firstChild);
		}
	}
}
//End


//---------------------------------------------------------------------------
// 1. 체크박스 컨트롤
	$(document).ready(
		//document.getElementById('classId').value = document.getElementById('classId').options[document.getElementById('classId').selectedIndex];
		//"전체" 체크박스의 상태에 따라 나머지 체크박스의 상태를 변경
		chkAll.on("change", function () {
			isChecked = chkAll.prop("checked");
			chkList.prop("checked", isChecked);
		}),
		//End
		//개별 체크박스가 변경될 때 "전체" 체크박스 상태 업데이트
		chkList.on("change", function () {
			allChecked = chkList.filter(":checked").length === chkList.length;
			chkAll.prop("checked", allChecked);
		})
		//End
	);
//End : 체크박스 컨트롤

// 2. 검색 누르면 검색하세요
	function search(){
		//1) tbody의 내용물을 비운다
		clearTable();
		//2) tbody에 붙일 내용물을 만든다
		var classId = document.getElementById('classId').options[document.getElementById('classId').selectedIndex].value;
		var startDate = document.getElementById("startDate").value;
		var endDate = document.getElementById("endDate").value;
		var title = document.getElementById("endDate").value;
		var date = new Date();
		var year = date.getFullYear();
		function getFirstDay(){var month = ("0" + (1 + date.getMonth())).slice(-2);var day = "01";return year + "-" + month + "-" + day;}
		function getLastDay(){var month = ("0" + (1 + date.getMonth())).slice(-2);var lastDay = new Date(year,month, 0).getDate();return year + "-" + month + "-" + lastDay;}
		if(startDate==''){startDate=getFirstDay();}
		if(endDate==''){endDate=getLastDay();}
		//3) tbody에 붙인다
	}
//End : 검색 버튼 누르면 검색

// 3. 이수 여부를 변경시키세요
</script>

</body>
</html>