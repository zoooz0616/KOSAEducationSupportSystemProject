<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/include/manager_header :: header}">
<meta charset="UTF-8">
<title>기업 관리</title>
</head>
<head>
<link th:href="@{/css/admin/commoncode_list.css}" rel="stylesheet">
</head>
<body>
	<!-- 서브바-->
	<div th:replace="~{/include/manager_subbar :: subbar}"></div>
	<!-- 서브바 -->

	<!-- Content Wrap -->
	<div class="home-section">

		<!-- Content Top -->
		<div class="content_top">
			<!-- Title -->
			<div class="title">기준정보 관리</div>
			<!-- Route -->
			<div class="route">
				<a th:href="@{/admin}">대시보드</a> > <a
					th:href="@{/admin/commoncode/list}">기준정보 관리</a>
			</div>
		</div>
		<!-- Content Top -->

		<!-- Content Middle-->
		<div class="content_middle">
			<!-- left section -->
			<div class="left_section">
				<!-- 그룹코드 관리 -->
				<div class="lecture_wrap" style="height: 100%;">

					<!-- Search Filter wrap -->
					<div class="search_filter_wrap" style="padding: 5px;">
						<div style="display: flex;">
							<div class="search_filter">
								<span>코드구분</span> <input type="text" class="group_code_tpcd_id"
									placeholder="코드구분" maxlength="3">
							</div>
							<div class="search_filter">
								<span>코드구분명</span> <input type="text" class="group_code_cmcd_nm"
									placeholder="코드구분명">
							</div>
						</div>

						<!-- Search Button wrap -->
						<div class="search_filter_btn_wrap">
							<button type="button" class="reset_btn" onclick="resetGroupInput()">
								<img th:src="@{/img/reset_white.png}"> <span>초기화</span>
							</button>
							<button type="button" class="search_btn" onclick="searchGroupCode()">
								<img th:src="@{/img/search_white.png}"> <span>조회</span>
							</button>
						</div>
						<!-- Search Button wrap -->
					</div>
					<!-- Search Filter wrap -->


					<!-- 총 개수 및 버튼-->
					<div class="content_info_wrap">
						<div>
							총 <span class="cnt group_cnt"
								th:text="${#lists.size(groupCodeList)}"></span> 건
						</div>
						<div class="content_info_btn_wrap">
							<!-- 등록하기 버튼 -->
							<button type="button" onclick="showInsertGroupPopup();">
								<img th:src="@{/img/plus_white.png}"><span>등록하기</span>
							</button>
							<!-- 등록하기 버튼 -->

							<button id="group_delete_btn">
								<img th:src="@{/img/minus_white.png}">선택삭제
							</button>

							<button id="group_update_btn" onclick="enterGroupEditMode()">
								<img th:src="@{/img/update_white.png}"> <span>수정하기</span>
							</button>

							<button id="group_cancel_btn" onclick="cancelGroupEditMode()"
								style="display: none;">
								<img th:src="@{/img/x_white.png}"> <span>수정취소</span>
							</button>

							<button id="group_save_btn" onclick="saveGroupCode()"
								style="display: none;">
								<img th:src="@{/img/save_white.png}"> <span>저장하기</span>
							</button>
						</div>
					</div>
					<!-- 총 개수 및 버튼-->

					<!-- 리스트 -->
					<div class="table_wrap"
						style="height: 80%; border: 1px solid #CFDEE6;">
						<table>
							<thead>
								<tr class="content_list_th">
									<th style="width: 5%;"><input type="checkbox"
										onclick="groupSelectAll(this)" id="groupChkAll"
										name="group_select_all" class="lecture_checkbox_all"></th>
									<th style="width: 10%;">번호</th>
									<th style="width: 25%;">공통코드ID</th>
									<th style="width: 25%;">코드구분</th>
									<th style="width: 25%;">코드구분명</th>
									<th style="width: 10%;">사용여부</th>
								</tr>
							</thead>
							<tbody class="group_tbody">
								<tr th:each="groupCode,iterStat : ${groupCodeList}">
									<td class="td_group_check_box"><input type="checkbox"
										onclick="groupCheckSelectAll()"
										class="group_chk group_checkbox_item" name="group_select"
										th:value="${groupCode.cmcdId}"> <input type="hidden"
										class="group_update_yn" value="N"></td>
									<td class="td_num" th:text="${iterStat.index+1}"></td>
									<td class="td_cmcd_id"><div th:text="${groupCode.cmcdId}"></div></td>
									<td class="td_tpcd_id">
										<div th:onclick="detailCodeList([[${groupCode.cmcdId}]])"
											class="group_code_id" th:text="${groupCode.tpcdId}"></div>
									</td>
									<td class="td_cmcd_nm">
										<div class="group_div" th:text="${groupCode.cmcdNm}"></div> <input
										class="group_input group_cmcd_nm" type="text"
										th:value="${groupCode.cmcdNm}" style="display: none;">
									</td>
									<td class="td_use_yn">
										<div class="group_div" th:text="${groupCode.useYn}"></div> <select
										class="group_input group_use_yn" style="display: none;">
											<option value="Y" th:selected="${groupCode.useYn == 'Y'}">Y</option>
											<option value="N" th:selected="${groupCode.useYn == 'N'}">N</option>
									</select>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- 리스트 -->
				</div>
				<!-- 그룹코드 관리 -->
			</div>
			<!-- left section -->

			<!-- right section -->
			<div class="right_section">
				<!-- 상세코드 관리 -->
				<div class="lecture_wrap" style="height: 100%;">

					<!-- 상세코드 조회하기 -->
					<div class="search_filter_wrap" style="padding: 5px;">
						<div style="display: flex;">
							<div class="search_filter">
								<span>코드구분</span> 
								<select id="group_code_select">
									<option value="all">선택</option>
									<option th:each="groupCode: ${groupCodeList}"
										th:value="${groupCode.cmcdId}" th:text="${groupCode.tpcdId}"></option>
								</select>
							</div>
							<div class="search_filter">
								<span>상세코드명</span> <input class="detailCmcdNm" type="text"
									placeholder="상세코드명">
							</div>
						</div>
						<!-- Search Button wrap -->
						<div class="search_filter_btn_wrap">
							<button type="button" class="reset_btn" onclick="resetDetailInput()">
								<img th:src="@{/img/reset_white.png}"> <span>초기화</span>
							</button>
							<button type="button" class="search_btn" onclick="search()">
								<img th:src="@{/img/search_white.png}"> <span>조회</span>
							</button>
						</div>
						<!-- Search Button wrap -->
					</div>
					<!-- 상세코드 조회하기 -->

					<!-- 총 개수 및 버튼-->
					<div class="content_info_wrap">
						<div>
							상세코드 총 <span class="detailCodeCnt"
								th:text="${#lists.size(detailCodeList)}">0</span> 건
						</div>
						<div class="content_info_btn_wrap">
							<!-- 등록하기 버튼 -->
							<button type="button" onclick="showInsertDetailPopup();">
								<img th:src="@{/img/plus_white.png}"><span>등록하기</span>
							</button>
							<!-- 등록하기 버튼 -->

							<button type="button" id="detail_delete_btn"
								style="display: none;">
								<img th:src="@{/img/minus_white.png}">선택삭제
							</button>

							<button id="detail_update_btn" onclick="enterDetailEditMode()"
								style="display: none;">
								<img th:src="@{/img/update_white.png}"> <span>수정하기</span>
							</button>

							<button id="detail_cancel_btn" onclick="cancelDetailEditMode()"
								style="display: none;">
								<img th:src="@{/img/x_white.png}"> <span>수정취소</span>
							</button>

							<button id="detail_save_btn" onclick="saveDetailCode()"
								style="display: none;">
								<img th:src="@{/img/save_white.png}"> <span>저장하기</span>
							</button>
						</div>
					</div>
					<!-- 총 개수 및 버튼-->

					<!-- 리스트 -->
					<div class="table_wrap"
						style="height: 80%; border: 1px solid #CFDEE6;">

						<div>
							<div class="error_div"
								th:if="${#lists.size(detailCodeList) == 0}">조회 결과가 없습니다.</div>
							<table style="display: none; width: 100%;"
								class="detail_code_table">
								<thead>
									<tr class="content_list_th">
										<th style="width: 10%;"><input type="checkbox"
											name="detail_select_all" onclick="detailSelectAll(this)"
											id="detailChkAll"></th>
										<th style="width: 10%;">번호</th>
										<th style="width: 30%;">상세코드ID</th>
										<th style="width: 30%;">상세코드명</th>
										<th style="width: 10%;">우선순위</th>
										<th style="width: 10%;">사용여부</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
						</div>
					</div>
					<!-- 리스트 -->
				</div>
				<!-- 상세코드 관리 -->
			</div>
			<!-- right section -->
		</div>
		<!-- Content Middle-->
	</div>

	<script>
	var selectedCode = "";
	
	
	/*
	*전체 선택 및 개별 선택
	*/
	//그룹코드 전체선택
	function groupSelectAll(selectAll){
		//모든 체크박스들
		const checkboxes = document.querySelectorAll('input[name="group_select"]');
		checkboxes.forEach((checkbox) => {
			checkbox.checked = selectAll.checked;
		});
	}
	
	//그룹코드 개별 선택
	function groupCheckSelectAll(){
		//전체선택 체크박스
		const selectAll = document.querySelector('input[name="group_select_all"]');
		//모든 체크박스
		const checkboxes = document.querySelectorAll('input[name="group_select"]');
		//선택된 체크박스
		const checked = document.querySelectorAll('input[name="group_select"]:checked');
		
		if(checkboxes.length == checked.length){
			selectAll.checked = true;
		}else{
			selectAll.checked = false;
		}
	}
	
	//상세코드 전체선택
	function detailSelectAll(selectAll){
		//모든 체크박스들
		const checkboxes = document.querySelectorAll('input[name="detail_select"]');
		checkboxes.forEach((checkbox) => {
			checkbox.checked = selectAll.checked;
		});
	}
	
	//상세코드 개별 선택
	function detailCheckSelectAll(){
		//전체선택 체크박스
		const selectAll = document.querySelector('input[name="detail_select_all"]');
		//모든 체크박스
		const checkboxes = document.querySelectorAll('input[name="detail_select"]');
		//선택된 체크박스
		const checked = document.querySelectorAll('input[name="detail_select"]:checked');
		
		if(checkboxes.length == checked.length){
			selectAll.checked = true;
		}else{
			selectAll.checked = false;
		}
	}

	/*
	* 선택삭제 이벤트
	*/
		//그룹코드 선택삭제
		document
				.querySelector("#group_delete_btn")
				.addEventListener(
						"click",
						function() {
							
							var selectedGroupCodeIds = [];

							// 선택된 체크박스를 모두 선택합니다.
							var selectedCheckboxes = document
									.querySelectorAll(".group_chk:checked");

							// 선택된 체크박스의 값을 배열에 추가합니다.
							selectedCheckboxes.forEach(function(checkbox) {
								selectedGroupCodeIds.push(checkbox.value);
							});

							//선택한 개수 확인
							if(selectedGroupCodeIds.length == 0){
								alert("선택된 공통코드가 없습니다.");
							}else{
								//진짜 삭제할 건지 확인
								if(!confirm("삭제하시겠습니까?")){
									//아니오
								}else{
									//확인
									// Ajax 요청에서 selectedLectureIds를 배열로 전송합니다.
									$
											.ajax({
												url : '/admin/commoncode/delete/groupcode',
												method : 'POST',
												data : {
													selectedGroupCodeIds : selectedGroupCodeIds
												},
												success : function(response) {
													if (response == "success") {
														alert("선택한 그룹코드가 삭제되었습니다.");
														window.location.href = "/admin/commoncode/list";
													}
												}
											});
								}
							}							
						});
		
		//상세코드 선택삭제
		document.querySelector("#detail_delete_btn").addEventListener(
				"click",
				function() {
					var selectedDetailCodeIds = [];

					// 선택된 체크박스를 모두 선택합니다.
					var selectedCheckboxes = document
							.querySelectorAll(".detail_chk:checked");

					// 선택된 체크박스의 값을 배열에 추가합니다.
					selectedCheckboxes.forEach(function(checkbox) {
						selectedDetailCodeIds.push(checkbox.value);
					});

					if(selectedDetailCodeIds.length == 0){
						alert("선택된 상세코드가 없습니다.");
					}else {
						//진짜 삭제할 건지 확인
						if(!confirm("삭제하시겠습니까?")){
							//아니오
						}else{
						$.ajax({
							url : '/admin/commoncode/delete/detailcode',
							method : 'POST',
							data : {
								selectedDetailCodeIds : selectedDetailCodeIds
							},
							success : function(response) {
									alert("선택한 상세코드가 삭제되었습니다.");
									selectDetailCodeList(response);
								
							}
						});
						}
					}
				});

		
		/*
		*그룹코드 리스트 뿌리기
		*/
		function selectGroupCodeList(){
			//버튼 보이게 하기
			const deleteBtn = document.querySelector('#group_delete_btn');
	        const updateBtn = document.querySelector('#group_update_btn');
	        const cancelBtn = document.querySelector('#group_cancel_btn');
	        const saveBtn = document.querySelector('#group_save_btn');

	        //버튼 display 수정
	        deleteBtn.style.display = 'flex';
	        updateBtn.style.display = 'flex';
	        cancelBtn.style.display = 'none';
	        saveBtn.style.display = 'none';
	        
	        $.ajax({
	        	url: '/admin/commoncode/getgroupcodelist',
	        	method: 'GET',
	        	success: function(response){
	        		var groupCodeList = response;
	        		
	        		//그룹코드 개수 재설정
	        		var groupCnt = document.querySelector('.group_cnt');
	        		groupCnt.textContent = groupCodeList.length;
	        		
	        		//테이블 비우고 다시 넣기
	        		var groupTbody = document.querySelector('.group_tbody');
	        		$('.group_tbody').empty();
	        		
	        		for(var i=0; i<groupCodeList.length; i++){
	        			var groupCode = groupCodeList[i];
	        			
	        			var tr = document.createElement('tr');
	        			
	        			//체크박스
	        			var tdCheck = document.createElement('td');
	        			tdCheck.className="td_group_check_box";
	        			var inputCheck = document.createElement('input');
	        			inputCheck.type="checkbox";
	        			inputCheck.onclick=function(){
	        				groupCheckSelectAll();
	        			}
	        			inputCheck.className = "group_chk group_checkbox_item";
	        			inputCheck.name ='group_select';
	        			inputCheck.value=groupCode.cmcdId;
	        			var inputHidden = document.createElement('input');
	        			inputHidden.type="hidden";
	        			inputHidden.className='group_update_yn';
	        			inputHidden.value="N";
	        			tdCheck.appendChild(inputCheck);
	        			tdCheck.appendChild(inputHidden);
	        			tr.appendChild(tdCheck);
	        			
	        			//번호
	        			var tdNum = document.createElement('td');
	        			tdNum.className="td_num";
	        			tdNum.textContent = i+1;
	        			tr.appendChild(tdNum);
	        			
	        			//공통코드ID
	        			var tdCmcdId = document.createElement('td');
	        			tdCmcdId.className = 'td_cmcd_id';
	        			var divCmcdId = document.createElement('div');
	        			divCmcdId.textContent = groupCode.cmcdId;
	        			tdCmcdId.appendChild(divCmcdId);
	        			tr.appendChild(tdCmcdId);
	        			
	        			//tpcdId
	        			var tdTpcdId = document.createElement('td');
	        			tdTpcdId.className ='td_tpcd_id';
	        			var divTpcdId = document.createElement('div');
	        			divTpcdId.onclick = function(){
	        				detailCodeList(groupCode.cmcdId);
	        			}
	        			divTpcdId.className = 'group_code_id';
	        			divTpcdId.textContent = groupCode.tpcdId;
	        			
	        			tdTpcdId.appendChild(divTpcdId);
	        			tr.appendChild(tdTpcdId);
	        			
	        			//cmcdNm
	        			var tdCmcdNm = document.createElement('td');
	        			tdCmcdNm.className='td_cmcd_nm';
	        			var divCmcdNm = document.createElement('div');
	        			divCmcdNm.className='group_div';
	        			divCmcdNm.textContent=groupCode.cmcdNm;
	        			var inputCmcdNm = document.createElement('input');
	        			inputCmcdNm.className='group_input group_cmcd_nm';
	        			inputCmcdNm.type="text";
	        			inputCmcdNm.value=groupCode.cmcdNm;
	        			inputCmcdNm.style.display='none';
	        			tdCmcdNm.appendChild(divCmcdNm);
	        			tdCmcdNm.appendChild(inputCmcdNm);
	        			tr.appendChild(tdCmcdNm);
	        			
	        			//useYn
	        			var tdUseYn = document.createElement('td');
	        			tdUseYn.className='td_use_yn';
	        			var divUseYn = document.createElement('div');
	        			divUseYn.className='group_div';
	        			divUseYn.textContent = groupCode.useYn;
	        			var selectUseYn = document.createElement('select');
	        			selectUseYn.className='group_input group_use_yn';
	        			selectUseYn.style.display = 'none';
	        			var optionY = document.createElement('option');
	        			optionY.value="Y";
	        			optionY.textContent = "Y";
	        			var optionX = document.createElement('option');
	        			optionX.value="X";
	        			optionX.textContent = 'X';
	        			selectUseYn.appendChild(optionY);
	        			selectUseYn.appendChild(optionX);
	        			selectUseYn.value=groupCode.useYn;
	        			tdUseYn.appendChild(divUseYn);
	        			tdUseYn.appendChild(selectUseYn);
	        			tr.appendChild(tdUseYn);
	        			
	        			groupTbody.appendChild(tr);
	        		}
	        		
	        		//그룹코드 수정하면 update_yn=Y로 바꾸기
	        		var groupInputs = document.querySelectorAll('.group_input');
	        		groupInputs.forEach(function(groupInput) {
	        		    // onchange 이벤트를 추가합니다.
	        		    groupInput.addEventListener("change", function() {
	        		    	const parentTr = groupInput.closest('tr');
	        		    	var updateYnInput = parentTr.querySelector(".td_group_check_box .group_update_yn");
	        		    	updateYnInput.value = "Y";
	        		    });
	        		});
	        		
	        		
	        		//상세코드 등록에 필요한 그룹코드 select 다시 불러오기
	        		var groupCodeSelect = document.querySelector('#group_code_select');
	        		$('#group_code_select').empty();
	        		
	        		//선택option
	        		var optionDefault = document.createElement('option');
	        		optionDefault.value = 'all';
	        		optionDefault.textContent ='선택';
	        		groupCodeSelect.appendChild(optionDefault);
	        		
	        		
	        		for(var i =0; i<groupCodeList.length; i++){
	        			var groupCode = groupCodeList[i];
	        			
	        			var optionGroup = document.createElement('option');
	        			optionGroup.value = groupCode.cmcdId;
	        			optionGroup.textContent = groupCode.cmcdNm;
	        			groupCodeSelect.appendChild(optionGroup);
	        								
	        		}
	        	}
	        });
		}
		
		/*
		*그룹코드에 맞는 상세코드 리스트 뿌리기
		*/
		
		//cmcdId값에 맞는 상세코드 가져오기
		function selectDetailCodeList(cmcdId) {
			selectedCode = cmcdId;
			
			
			//버튼 보이게 하기
			const deleteBtn = document.querySelector('#detail_delete_btn');
	        const updateBtn = document.querySelector('#detail_update_btn');
	        const cancelBtn = document.querySelector('#detail_cancel_btn');
	        const saveBtn = document.querySelector('#detail_save_btn');

	        //버튼 display 수정
	        deleteBtn.style.display = 'flex';
	        updateBtn.style.display = 'flex';
	        cancelBtn.style.display = 'none';
	        saveBtn.style.display = 'none';
			
			
			
			//해당 id값에 맞는 상세코드 가져와서 뿌리기
			$
					.ajax({
						url : '/admin/commoncode/view/' + cmcdId,
						method : 'GET',
						data : {
							cmcdId : cmcdId
						},
						success : function(response) {
							var detailCodeList = response.detailCodeList;

							//결과 없음 페이지
							var errorDiv = document.querySelector(".error_div");

							//table선택
							var table = document
									.querySelector(".detail_code_table");

							if (detailCodeList.length > 0) {
								var cnt = document
										.querySelector(".detailCodeCnt");
								cnt.textContent = detailCodeList.length;

								//table아래의 <tbody> 요소를 선택
								var tbody = table.querySelector("tbody");

								//모든 <tr> 요소 제거
								tbody.innerHTML = "";

								// detailCodeList를 순회하며 <tr> 요소를 생성하여 추가
								for (var i = 0; i < detailCodeList.length; i++) {
									var detailCode = detailCodeList[i];

									// <tr> 요소 생성
									var tr = document.createElement("tr");

									// <td> 요소 생성 및 추가 (이 부분을 detailCode 객체의 필드에 따라 조정)
									var td1 = document.createElement("td");
									td1.className = "td_detail_check_box";
									td1.innerHTML = '<input type="checkbox" name="detail_select" onclick ="detailCheckSelectAll()" class="detail_chk detail_checkbox_item" value="' + detailCode.cmcdId + '">'+
													'<input type="hidden" class="detail_update_yn" value="N">'+
													'<input type="hidden" class="detail_tpcd_id" value="'+detailCode.tpcdId+'">';

									var tdNum = document.createElement("td");
									tdNum.className="td_num";
									tdNum.innerHTML = i + 1;

									var td2 = document.createElement("td");
									td2.className = 'td_cmcd_id';
									td2.innerHTML = detailCode.cmcdId;

									var td3 = document.createElement("td");
									td3.className = "td_cmcd_nm"
									td3.innerHTML = '<div class="detail_div">'
											+ detailCode.cmcdNm
											+ '</div><input class="detail_input detail_cmcd_nm" type="text" value="' + detailCode.cmcdNm + '" style="display: none;">';

									var td4 = document.createElement("td");
									td4.className = "td_order";
									td4.innerHTML = '<div class="detail_div">'
											+ detailCode.cmcdOrder
											+ '</div><input class="detail_input detail_cmcd_order" type="number" value="' + detailCode.cmcdOrder + '" style="display: none;">';

									var td5 = document.createElement("td");
									td5.className = "td_use_yn";
									td5.innerHTML = '<div class="detail_div">'
											+ detailCode.useYn + '</div>';

									// <select> 요소 생성
									var select = document
											.createElement("select");
									select.className = "detail_input detail_use_yn";
									select.style.display = "none";

									// "Y" 옵션 추가
									var optionY = document
											.createElement("option");
									optionY.value = "Y";
									optionY.text = "Y";
									if (detailCode.useYn === "Y") {
										optionY.selected = true;
									}
									select.appendChild(optionY);

									// "N" 옵션 추가
									var optionN = document
											.createElement("option");
									optionN.value = "N";
									optionN.text = "N";
									if (detailCode.useYn === "N") {
										optionN.selected = true;
									}
									select.appendChild(optionN);

									td5.appendChild(select);

									// <tr> 요소에 <td> 요소들 추가
									tr.appendChild(td1);
									tr.appendChild(tdNum);
									tr.appendChild(td2);
									tr.appendChild(td3);
									tr.appendChild(td4);
									tr.appendChild(td5);

									// <tr> 요소를 <tbody>에 추가
									tbody.appendChild(tr);

									errorDiv.style.display = "none";
									//테이블 보이게
									table.style.display = "table";
								}
							} else {
								var cnt = document
										.querySelector(".detailCodeCnt");
								cnt.textContent = 0;

								table.style.display = "none";
								errorDiv.style.display = "block";
							}
							
							
							
							//상세코드 input에 수정 발생시 해당 tr update_yn = Y로 변경
							var detailInputs = document.querySelectorAll('.detail_input');
							detailInputs.forEach(function(detailInput) {
							    // onchange 이벤트를 추가합니다.
							    detailInput.addEventListener("change", function() {
							    	const parentTr = detailInput.closest('tr');
							    	var updateYnInput = parentTr.querySelector(".td_detail_check_box .detail_update_yn");
							    	updateYnInput.value = "Y";
							    });
							});
						}
					});
		}

		//그룹코드 클릭 => 상세코드 리스트 보기
		function detailCodeList(cmcdId) {
			var cmcdId = cmcdId;
			selectedCode = cmcdId;
			
			selectDetailCodeList(cmcdId);
			
			//상세코드 조회부분 select option설정.
			var searchDetailCodeSelect = document.querySelector("#group_code_select");
			searchDetailCodeSelect.value = cmcdId; 
			searchDetailCodeSelect.disabled = true;
		}
		
		// <select> 요소에 onchange 이벤트 핸들러를 할당
		document.getElementById("group_code_select").onchange = function handleSelectChange() {
			var cmcdId = document.getElementById("group_code_select").value;
			// 선택한 옵션의 값에 대한 처리를 여기에 추가하세요.
			console.log("선택한 값:", cmcdId);
			// 여기에서 필요한 동작을 수행하세요.

			selectDetailCodeList(cmcdId);
		};
		
		/*
		*수정하기 버튼 클릭시 수정모드로 전환
		*/
		//그룹코드 수정 버튼
		function enterGroupEditMode() {
			const deleteBtn = document.querySelector('#group_delete_btn');
	        const updateBtn = document.querySelector('#group_update_btn');
	        const cancelBtn = document.querySelector('#group_cancel_btn');
	        const saveBtn = document.querySelector('#group_save_btn');

	        //버튼 display 수정
	        deleteBtn.style.display = 'none';
	        updateBtn.style.display = 'none';
	        cancelBtn.style.display = 'flex';
	        saveBtn.style.display = 'flex';
	        
	      	//본래의 div 숨기기
	        const detailDivs = document.querySelectorAll('.group_div');
	        detailDivs.forEach((detailDiv)=>{
	        	detailDiv.style.display = 'none';
	        });
	        
	        //editInput 보이게 하기
	        const detailInputs = document.querySelectorAll('.group_input');
	        detailInputs.forEach((detailInput)=>{
	        	detailInput.style.display = 'block';
	        });
		}
		

		//상세코드 수정 버튼
		function enterDetailEditMode() {
			const deleteBtn = document.querySelector('#detail_delete_btn');
	        const updateBtn = document.querySelector('#detail_update_btn');
	        const cancelBtn = document.querySelector('#detail_cancel_btn');
	        const saveBtn = document.querySelector('#detail_save_btn');

	        //버튼 display 수정
	        deleteBtn.style.display = 'none';
	        updateBtn.style.display = 'none';
	        cancelBtn.style.display = 'flex';
	        saveBtn.style.display = 'flex';
	        
	      	//본래의 div 숨기기
	        const detailDivs = document.querySelectorAll('.detail_div');
	        detailDivs.forEach((detailDiv)=>{
	        	detailDiv.style.display = 'none';
	        });
	        
	        //editInput 보이게 하기
	        const detailInputs = document.querySelectorAll('.detail_input');
	        detailInputs.forEach((detailInput)=>{
	        	detailInput.style.display = 'block';
	        });
		}
		
		
		/*
		*수정취소 버튼 클릭시 수정모드 취소
		*/
		//그룹코드 수정하기 취소
		function cancelGroupEditMode(){
			const deleteBtn = document.querySelector('#group_delete_btn');
	        const updateBtn = document.querySelector('#group_update_btn');
	        const cancelBtn = document.querySelector('#group_cancel_btn');
	        const saveBtn = document.querySelector('#group_save_btn');

	        //버튼 display 수정
	        deleteBtn.style.display = 'flex';
	        updateBtn.style.display = 'flex';
	        cancelBtn.style.display = 'none';
	        saveBtn.style.display = 'none';
	        
	      	//본래의 div 보이기
	        const detailDivs = document.querySelectorAll('.group_div');
	        detailDivs.forEach((detailDiv)=>{
	        	detailDiv.style.display = 'block';
	        });
	        
	        //editInput 숨기기
	        const detailInputs = document.querySelectorAll('.group_input');
	        detailInputs.forEach((detailInput)=>{
	        	detailInput.style.display = 'none';
	        });
		}
		
		
		//상세코드 수정하기 취소
		function cancelDetailEditMode(){
			const deleteBtn = document.querySelector('#detail_delete_btn');
	        const updateBtn = document.querySelector('#detail_update_btn');
	        const cancelBtn = document.querySelector('#detail_cancel_btn');
	        const saveBtn = document.querySelector('#detail_save_btn');

	        //버튼 display 수정
	        deleteBtn.style.display = 'flex';
	        updateBtn.style.display = 'flex';
	        cancelBtn.style.display = 'none';
	        saveBtn.style.display = 'none';
	        
	      	//본래의 div 나타내기
	        const detailDivs = document.querySelectorAll('.detail_div');
	        detailDivs.forEach((detailDiv)=>{
	        	detailDiv.style.display = 'block';
	        });
	        
	        //editInput 숨기기
	        const detailInputs = document.querySelectorAll('.detail_input');
	        detailInputs.forEach((detailInput)=>{
	        	detailInput.style.display = 'none';
	        });
		}
		
	/*
	*수정모드에서 값 변경시 update_yn=Y로 변경하기
	*/
	//그룹코드 input에 수정 발생시 해당 tr update_yn = Y로 변경
	var groupInputs = document.querySelectorAll('.group_input');
	groupInputs.forEach(function(groupInput) {
	    // onchange 이벤트를 추가합니다.
	    groupInput.addEventListener("change", function() {
	    	const parentTr = groupInput.closest('tr');
	    	var updateYnInput = parentTr.querySelector(".td_group_check_box .group_update_yn");
	    	updateYnInput.value = "Y";
	    });
	});
	
	//상세코드 input에 수정 발생시 해당 tr update_yn = Y로 변경
	var detailInputs = document.querySelectorAll('.detail_input');
	detailInputs.forEach(function(detailInput) {
	    // onchange 이벤트를 추가합니다.
	    detailInput.addEventListener("change", function() {
	    	console.log("바뀜요");
	    	const parentTr = detailInput.closest('tr');
	    	var updateYnInput = parentTr.querySelector(".td_detail_check_box .detail_update_yn");
	    	updateYnInput.value = "Y";
	    });
	});
	
	/*
	*	저장하기 이벤트
	*/
	//그룹코드 저장하기 버튼 클릭
	function saveGroupCode(){
		//수정된 상세코드 리스트를 담을 배열 선언
		var updateGroupList = [];
		
		//한 행씩 딕셔너리 만들어서 배열에 넣기
		var hiddenInputs = document.querySelectorAll('tr .td_group_check_box .group_update_yn[value=Y]');
		hiddenInputs.forEach((hiddenInput)=>{
			//수정된 상세코드 객체를 담을 딕셔너리 선언
			var groupCode = {};
			
			//updateYn = 'Y'인 인풋의 부모 tr찾기
			var parentTr = hiddenInput.closest('tr');
			
			//id와 수정가능한 input의 값들 뽑기
			var cmcdId = parentTr.querySelector('.td_group_check_box .group_checkbox_item').value;
			var cmcdNm = parentTr.querySelector('.td_cmcd_nm .group_cmcd_nm').value;
			var useYn = parentTr.querySelector('.td_use_yn .group_use_yn').value;
			
			//딕셔너리의 키값에 값 넣기
			groupCode['cmcdId'] = cmcdId;
			groupCode['cmcdNm'] = cmcdNm;
			groupCode['useYn'] = useYn;
						
			//배열에 push하기
			updateGroupList.push(groupCode);
		});
		
		if(updateGroupList.length == 0){
			alert("수정사항이 없습니다.");
		}else{
			//객체 배열을 json문자열로 직렬화 하기
			var jsonData = JSON.stringify(updateGroupList);
			
			//비동기로 배열 전달하기
			fetch('/admin/commoncode/update/groupcode', {
	    		method: 'POST',
	    		headers: {
	        		'Content-Type': 'application/json',
	    		},
	    		body: jsonData,
			})
			.then(response =>response.json())
			.then(data => {
				console.log(data);
				if (data.message === "success") {
			        alert("그룹코드가 수정되었습니다.");
			        //그룹코드리스트 다시 불러오기
			        selectGroupCodeList();
			        
			    } else {
			    	alert("실패했습니다. 다시 시도해주세요.");
			    }
			})
			.catch(error => {
	    		// 오류 처리
			});
		}
		
	}
	
	//상세코드 저장하기 버튼 클릭
	function saveDetailCode(){		
		var groupCmcdId;
		
		//수정된 상세코드 리스트를 담을 배열 선언
		var updateDetailList = [];
		
		//한 행씩 딕셔너리 만들어서 배열에 넣기
		var hiddenInputs = document.querySelectorAll('tr .td_detail_check_box .detail_update_yn[value=Y]');
		hiddenInputs.forEach((hiddenInput)=>{
			//수정된 상세코드 객체를 담을 딕셔너리 선언
			var detailCode = {};
			
			//updateYn = 'Y'인 인풋의 부모 tr찾기
			var parentTr = hiddenInput.closest('tr');
			
			//id와 수정가능한 input의 값들 뽑기
			var cmcdId = parentTr.querySelector('.td_detail_check_box .detail_checkbox_item').value;
			var cmcdNm = parentTr.querySelector('.td_cmcd_nm .detail_cmcd_nm').value;
			var cmcdOrder = parentTr.querySelector('.td_order .detail_cmcd_order').value;
			var useYn = parentTr.querySelector('.td_use_yn .detail_use_yn').value;
			var tpcdId = parentTr.querySelector('.td_detail_check_box .detail_tpcd_id').value;
			
			groupCmcdId = tpcdId;
			
			//딕셔너리의 키값에 값 넣기
			detailCode['cmcdId'] = cmcdId;
			detailCode['cmcdNm'] = cmcdNm;
			detailCode['cmcdOrder'] = cmcdOrder;
			detailCode['useYn'] = useYn;
						
			//배열에 push하기
			updateDetailList.push(detailCode);
		});
			
		if(updateDetailList.length === 0){
			alert("수정 사항이 없습니다.");
		}else{
			//객체 배열을 json문자열로 직렬화 하기
			var jsonData = JSON.stringify(updateDetailList);
			
			console.log(jsonData);
			
			//비동기로 배열 전달하기
			fetch('/admin/commoncode/update/detailcode', {
	    		method: 'POST',
	    		headers: {
	        		'Content-Type': 'application/json',
	    		},
	    		body: jsonData,
			})
			.then(response =>response.json())
			.then(data => {
				console.log(data);
				if (data.message === "success") {
			        alert("상세코드가 수정되었습니다.");
			        //그룹코드에 맞는 해당 리스트 다시 불러오기
			        
			        console.log(groupCmcdId);
			        selectDetailCodeList(groupCmcdId);
			    } else {
			    	alert("실패했습니다. 다시 시도해주세요.");
			    }
			})
			.catch(error => {
	    		// 오류 처리
			});
		}
	}
	
	function showInsertGroupPopup(){
		window.open(
				"/admin/commoncode/insert/groupcode", "insertgroupcode", 
				"width=500, height=250, left=900, top=500"		
		);
	}
	
	var popup;
	
	function showInsertDetailPopup(){
		if(selectedCode === ""){
			selectedCode = "all";
		}
		
		var url = "/admin/commoncode/insert/detailcode/popup/" + selectedCode;
		popup = window.open(
				url, "insertdetailcode", 
				"width=500, height=290, left=900, top=500"		
		);
		
		popup.onbeforeunload = function() {
			if(selectedCode === ""){
				selectDetailCodeList(selectedCode);
			}
		};
	}
	
	//그룹코드 초기화 버튼
	function resetGroupInput() {
		// 모든 요소를 선택
		const inputElement1 = document.querySelector(".group_code_tpcd_id");
		inputElement1.value = "";

		// 모든 요소를 선택
		const inputElement2 = document.querySelector(".group_code_cmcd_nm");
		inputElement2.value = "";
	}
	
	//상세코드 초기화 버튼
	function resetDetailInput() {
		// 모든 요소를 선택
		const inputElement1 = document.querySelector("#group_code_select");
		inputElement1.value = "all";

		// 모든 요소를 선택
		const inputElement2 = document.querySelector(".detailCmcdNm");
		inputElement2.value = "";
	}
	
	//그룹코드 검색
	function searchGroupCode(){
		
	}
	
	//상세코드 검색
	function searchDetailCode(){
		// 코드 구분값
		const tpcdIdSelect = document.querySelector("#group_code_select");
		var tpcdId = tpcdIdSelect.value;

		// 상세코드명
		const cmcdNmInput = document.querySelector(".detailCmcdNm");
		var cmcdNm = cmcdNmInput.value;
		
		if(tpcdId === "all" || cmcdNmInput === ""){
			alert()
		}
	}
	
	</script>
</body>
</html>