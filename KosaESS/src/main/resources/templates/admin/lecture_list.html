<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/include/manager_header :: header}">
<meta charset="UTF-8">
<title>강사 관리</title>
</head>
<head>
<link th:href="@{/css/admin/lecture_list.css}" rel="stylesheet">
</head>
<body>
	<!-- 서브바-->
	<div th:replace="~{/include/manager_subbar :: subbar}"></div>
	<!-- 서브바 -->

	<!-- Content Wrap -->
	<div class="home-section">

		<!-- Content Top -->
		<div class="content_top">
			<!-- Title -->
			<div class="title">강의 관리</div>
			<!-- Route -->
			<div class="route">
				<a th:href="@{/admin}">대시보드</a> > <a
					th:href="@{/admin/lecture/list}">강의 관리</a>
			</div>
		</div>
		<!-- Content Top -->

		<!-- Content Middle-->
		<div class="content_middle">
			<!-- left section -->
			<div class="left_section">
				<!-- 강의 관리 -->
				<div class="lecture_wrap" style="height: 100%;">

					<!-- 총 개수 및 버튼-->
					<div class="content_info_wrap">
						<div>
							강의 총 <span class="cnt" th:text="${#lists.size(lectureList)}"></span>
							개
						</div>
						<button id="lecture_delete_btn">선택삭제</button>
					</div>
					<!-- 총 개수 및 버튼-->

					<!-- 강의 등록하기 -->
					<div class="insert_lecture insert" style="padding: 5px;">
						<div>
							<span>과목명</span> <select id="subject_id_input">
								<option th:each="subject: ${ySubjectList}"
									th:value="${subject.sbjtId}" th:text="${subject.sbjtNm}">
							</select> <span>강사명</span> <select id="professor_id_input">
								<option th:each="professor: ${yProfessorList}"
									th:value="${professor.profId}" th:text="${professor.profNm}">
							</select> <span>강의명</span> <input id="lecture_nm_input" value=""
								type="text" placeholder="강의명" style="width: 150px;"> <span>이수시간</span>
							<input id="lecture_tm_input" type="number" value="0"
								style="width: 100px;">
						</div>
						<div>
							<button class="insert_btn" type="button"
								onclick="insertLecture()">등록하기</button>
						</div>
					</div>
					<!-- 강의 등록하기 -->

					<!-- 리스트 -->
					<div class="table_wrap lecture_table">
						<table>
							<tr class="content_list_th">
								<th><input type="checkbox" class="lecture_checkbox_all"></th>
								<th>ID</th>
								<th>강의명</th>
								<th>과목명</th>
								<th>강사명</th>
								<th>이수시간</th>
								<th>삭제여부</th>
								<th style="width: 100px;">관리</th>
							</tr>
							<tr th:each="lecture : ${lectureList}">
								<td style="text-align: center;"><input type="checkbox"
									th:value="${lecture.lctrId}" class="lecture_checkbox_item"></td>
								<td><span id="lecture_id" th:text="${lecture.lctrId}"></span></td>
								<td><span th:text="${lecture.lctrNm}" class="lecture_span"></span>
									<input style="display: none; width: 200px;"
									class="lecture_input lecture_nm" type="text" th:value="${lecture.lctrNm}"></td>
								<td><span th:text="${lecture.sbjtNm}"></span></td>
								<td><span th:text="${lecture.profNm}"></span></td>
								<td><span th:text="${lecture.lctrTm}" class="lecture_span"></span>
									<input style="display: none; width: 50px;"
									class="lecture_input lecture_tm" type="text" th:value="${lecture.lctrTm}">
								</td>
								<td><span th:text="${lecture.deleteYn}"></span></td>
								<td style="text-align: center;">
									<button class="lecture_span"  onclick="updateLecture(this)">수정</button>
									<button style="display: none;"class="lecture_input" onclick="saveLecture(this)">저장</button>
									<button style="display: none;"class="lecture_input" onclick="cancelEdit(this)">취소</button>
								</td>
							</tr>
						</table>
					</div>
					<!-- 리스트 -->
				</div>
				<!-- 강의 관리 -->
			</div>
			<!-- left section -->

			<!-- right section -->
			<div class="right_section">
				<!-- 과목 관리 -->
				<div class="subject_wrap" style="height: 50%;">
					<!-- 총 개수 및 버튼-->
					<div class="content_info_wrap">
						<div>
							과목 총 <span class="cnt" th:text="${#lists.size(subjectList)}"></span>
							개
						</div>
						<button id="subject_delete_btn">선택삭제</button>
					</div>
					<!-- 총 개수 및 버튼-->

					<!-- 과목 등록하기 -->
					<div class="insert_subject insert" style="padding: 5px;">
						<div>
							<span style="color: #0E5881; font-weight: bold;">과목명</span> <input
								id="subject_input" type="text" placeholder="과목명">
						</div>

						<div>
							<button class="insert_btn" type="button"
								onclick="insertSubject()">등록하기</button>
						</div>
					</div>
					<!-- 과목 등록하기 -->

					<!-- 리스트 -->
					<div class="table_wrap subject_table">
						<table>
							<tr class="content_list_th">
								<th><input type="checkbox" class="subject_checkbox_all"></th>
								<th>ID</th>
								<th>과목명</th>
								<th>삭제여부</th>
								<th style="width: 100px;">관리</th>
							</tr>
							<tr th:each="subject : ${subjectList}">
								<td style="text-align: center;"><input type="checkbox"
									class="subject_checkbox_item" th:value="${subject.sbjtId}"></td>
								<td th:text="${subject.sbjtId}"></td>
								<td>
									<span th:text="${subject.sbjtNm}" class="subject_span"></span>
									<input style="display:none;"type="text" class="subject_input subject_nm" th:value="${subject.sbjtNm}">
								</td>
								<td th:text="${subject.deleteYn}"></td>
								<td style="text-align: center;">
									<button class="subject_span" onclick="updateSubject(this)">수정</button>
									<button style="display: none;"class="subject_input" onclick="saveSubject(this)">저장</button>
									<button style="display: none;"class="subject_input" onclick="SubjectCancelEdit(this)">취소</button>
								</td>
							</tr>
						</table>
					</div>
					<!-- 리스트 -->
				</div>
				<!-- 과목 관리 -->

				<!-- 강사 관리 -->
				<div class="professor_wrap" style="height: 50%;">
					<!-- 총 개수 및 버튼-->
					<div class="content_info_wrap">
						<div>
							강사 총 <span class="cnt" th:text="${#lists.size(professorList)}"></span>
							명
						</div>
						<button id="professor_delete_btn">선택삭제</button>
					</div>
					<!-- 총 개수 및 버튼-->

					<!-- 강사 등록하기 -->
					<div class="insert_professor insert" style="padding: 5px;">
						<div>
							<span>강사명</span> <input id="professor_name_input" type="text"
								placeholder="강사명" style="width: 50px;"> <span>전화번호</span>
							<input id="professor_tel_input" type="text" placeholder="전화번호"
								style="width: 100px;"> <span>이메일</span> <input
								id="professor_email_input" type="email" placeholder="이메일"
								style="width: 150px;">
						</div>
						<div>
							<button class="insert_btn" type="button"
								onclick="insertProfessor()">등록하기</button>
						</div>
					</div>
					<!-- 강사 등록하기 -->

					<!-- 리스트 -->
					<div class="table_wrap professor_table">
						<table>
							<tr class="content_list_th">
								<th><input type="checkbox" class="professor_checkbox_all"></th>
								<th>ID</th>
								<th>강사명</th>
								<th>전화번호</th>
								<th>이메일</th>
								<th>삭제여부</th>
								<th style="width: 100px;">관리</th>
							</tr>
							<tr th:each="professor : ${professorList}">
								<td style="text-align: center;"><input type="checkbox"
									class="professor_checkbox_item" th:value="${professor.profId}"></td>
								<td th:text="${professor.profId}"></td>
								<td>
									<span class="professor_span" th:text="${professor.profNm}"></span>
									<input class="professor_input professor_nm" style="display: none;width:50px;" th:value="${professor.profNm}">
								</td>
								<td>
									<span class="professor_span" th:text="${professor.profTel}"></span>
									<input class="professor_input professor_tel" style="display: none;width:100px;" th:value="${professor.profTel}">
								</td>
								<td>
									<span class="professor_span"  th:text="${professor.profEmail}"></span>
									<input class="professor_input professor_email" style="display: none;width:200px;" th:value="${professor.profEmail}">
								</td>
								<td><span th:text="${professor.deleteYn}"
									class="lecture_span"></span> <input
									style="display: none; width: 100px;" class="lecture_input"
									type="text" th:value="${professor.deleteYn}" disabled>
								</td>
								<td style="text-align: center;">
									<button class="professor_span" onclick="updateProfessor(this)">수정</button>
									<button style="display: none;"class="professor_input" onclick="saveProfessor(this)">저장</button>
									<button style="display: none;"class="professor_input" onclick="ProfessorCancelEdit(this)">취소</button>
								</td>
							</tr>
						</table>
					</div>
					<!-- 리스트 -->
				</div>
				<!-- 강사 관리 -->
			</div>
			<!-- right section -->
		</div>
		<!-- Content Middle-->
	</div>

	<script>
		//과목 등록하기
		function insertSubject() {
			//input에 과목명 입력했는지 확인
			//입력 안 했으면 과목명을 입력해주세요 띄우기
			var subjectInput = document.querySelector("#subject_input").value;
			if (subjectInput === "") {
				alert("과목명을 입력해주세요.");
			} else {
				//비동기로 보내서 똑같은 과목명이 있는지 여부 확인
				$.ajax({
					url : '/admin/lecture/subject/insert',
					method : 'POST',
					data : {
						subjectInput : subjectInput
					},
					success : function(response) {
						//실패면 alert(중복)띄우기
						if (response == "fail") {
							alert("이미 존재하는 과목입니다.");
						} else if (response == "success") {
							//성공하면 과목이 추가되었습니다. alert띄우고 location여기로 다시 이동
							alert("과목이 추가되었습니다.");
							window.location.href = "/admin/lecture/list";
						}
					}
				});
			}
		}

		//강사등록
		function insertProfessor() {
			//input에 강사명, 전화번호, 이메일을 모두 입력했는지 확인
			var profNmInput = document.querySelector("#professor_name_input").value;
			var profTelInput = document.querySelector("#professor_tel_input").value;
			var profEmailInput = document
					.querySelector("#professor_email_input").value;

			if (profNmInput == "" || profTelInput == "" || profEmailInput == "") {
				alert("모든 필드를 입력해주세요.");
			} else {
				//3개의 값을 보내서 전화번호로 중복 확인
				$.ajax({
					url : '/admin/lecture/professor/insert',
					method : 'POST',
					data : {
						profNmInput : profNmInput,
						profTelInput : profTelInput,
						profEmailInput : profEmailInput
					},
					success : function(response) {
						//실패면 alert(중복)띄우기
						if (response == "fail") {
							alert("이미 존재하는 강사입니다.");
						} else if (response == "success") {
							//성공하면 강사가 추가되었습니다. alert띄우고 location여기로 다시 이동
							alert("강사가 추가되었습니다.");
							window.location.href = "/admin/lecture/list";
						}
					}
				});
			}
		}

		//강의 등록
		function insertLecture() {
			//강의명과 이수시간을 모두 등록했는지 확인
			var subjectIdInput = document.querySelector("#subject_id_input").value;
			var profIdInput = document.querySelector("#professor_id_input").value;
			var lecturNmInput = document.querySelector("#lecture_nm_input").value;
			var lectureTmInput = document.querySelector("#lecture_tm_input").value;

			console.log("오오옹");
			if (lecturNmInput === "" || lectureTmInput === "0") {
				alert("모든 필드를 입력해주세요");
			} else {
				//값을 모두 보내고 lectureNm으로 중복확인
				$.ajax({
					url : '/admin/lecture/insert',
					method : 'POST',
					data : {
						subjectIdInput : subjectIdInput,
						profIdInput : profIdInput,
						lecturNmInput : lecturNmInput,
						lectureTmInput : lectureTmInput
					},
					success : function(response) {
						//실패면 alert(중복)띄우기
						if (response == "fail") {
							alert("이미 존재하는 강의입니다.");
						} else if (response == "success") {
							//성공하면 강의가 추가되었습니다. alert띄우고 location여기로 다시 이동
							alert("강의가 추가되었습니다.");
							window.location.href = "/admin/lecture/list";
						}
					}
				});
			}
		}

		//강의 전체선택
		//전체 선택 체크박스를 선택합니다.
		var lectureCheckboxAll = document
				.querySelector(".lecture_checkbox_all");

		// 개별 체크박스를 선택합니다.
		var lectureCheckboxItems = document
				.querySelectorAll(".lecture_checkbox_item");

		// 전체 선택 체크박스의 변경 이벤트를 처리합니다.
		lectureCheckboxAll.addEventListener("change", function() {
			var isChecked = lectureCheckboxAll.checked;

			// 모든 개별 체크박스를 선택/해제합니다.
			lectureCheckboxItems.forEach(function(checkbox) {
				checkbox.checked = isChecked;
			});
		});

		//과목 전체선택
		//전체 선택 체크박스를 선택합니다.
		var subjectCheckboxAll = document
				.querySelector(".subject_checkbox_all");

		// 개별 체크박스를 선택합니다.
		var subjectCheckboxItems = document
				.querySelectorAll(".subject_checkbox_item");

		// 전체 선택 체크박스의 변경 이벤트를 처리합니다.
		subjectCheckboxAll.addEventListener("change", function() {
			var isChecked = subjectCheckboxAll.checked;

			// 모든 개별 체크박스를 선택/해제합니다.
			subjectCheckboxItems.forEach(function(checkbox) {
				checkbox.checked = isChecked;
			});
		});

		//강사 전체선택
		//전체 선택 체크박스를 선택합니다.
		var professorCheckboxAll = document
				.querySelector(".professor_checkbox_all");

		// 개별 체크박스를 선택합니다.
		var professorCheckboxItems = document
				.querySelectorAll(".professor_checkbox_item");

		// 전체 선택 체크박스의 변경 이벤트를 처리합니다.
		professorCheckboxAll.addEventListener("change", function() {
			var isChecked = professorCheckboxAll.checked;

			// 모든 개별 체크박스를 선택/해제합니다.
			professorCheckboxItems.forEach(function(checkbox) {
				checkbox.checked = isChecked;
			});
		});

		// 강의 선택삭제 버튼 이벤트
		document
				.querySelector("#lecture_delete_btn")
				.addEventListener(
						"click",
						function() {
							var selectedLectureIds = [];

							// 선택된 체크박스를 모두 선택합니다.
							var selectedCheckboxes = document
									.querySelectorAll(".lecture_checkbox_item:checked");

							// 선택된 체크박스의 값을 배열에 추가합니다.
							selectedCheckboxes.forEach(function(checkbox) {
								selectedLectureIds.push(checkbox.value);
							});

							// Ajax 요청에서 selectedLectureIds를 배열로 전송합니다.
							$
									.ajax({
										url : '/admin/lecture/lecture/deleteall',
										method : 'POST',
										data : {
											selectedLectureIds : selectedLectureIds
										},
										success : function(response) {
											console.log(response);
											if (response == "success") {
												alert("선택한 강의가 삭제되었습니다.");
												window.location.href = "/admin/lecture/list";
											}
										}
									});
						});

		//과목 선택삭제 버튼 이벤트
		document
				.querySelector("#subject_delete_btn")
				.addEventListener(
						"click",
						function() {
							var selectedSubjectIds = [];

							// 선택된 체크박스를 모두 선택합니다.
							var selectedCheckboxes = document
									.querySelectorAll(".subject_checkbox_item:checked");

							// 선택된 체크박스의 값을 배열에 추가합니다.
							selectedCheckboxes.forEach(function(checkbox) {
								selectedSubjectIds.push(checkbox.value);
							});

							// Ajax 요청에서 selectedLectureIds를 배열로 전송합니다.
							$
									.ajax({
										url : '/admin/lecture/subject/deleteall',
										method : 'POST',
										data : {
											selectedSubjectIds : selectedSubjectIds
										},
										success : function(response) {
											console.log(response);
											if (response == "success") {
												alert("선택한 과목이 삭제되었습니다.");
												window.location.href = "/admin/lecture/list";
											}
										}
									});
						});

		//강사 선택삭제 버튼 이벤트
		document
				.querySelector("#professor_delete_btn")
				.addEventListener(
						"click",
						function() {
							var selectedProfessorIds = [];

							// 선택된 체크박스를 모두 선택합니다.
							var selectedCheckboxes = document
									.querySelectorAll(".professor_checkbox_item:checked");

							// 선택된 체크박스의 값을 배열에 추가합니다.
							selectedCheckboxes.forEach(function(checkbox) {
								selectedProfessorIds.push(checkbox.value);
							});

							// Ajax 요청에서 selectedLectureIds를 배열로 전송합니다.
							$
									.ajax({
										url : '/admin/lecture/professor/deleteall',
										method : 'POST',
										data : {
											selectedProfessorIds : selectedProfessorIds
										},
										success : function(response) {
											console.log(response);
											if (response == "success") {
												alert("선택한 강사가 삭제되었습니다.");
												window.location.href = "/admin/lecture/list";
											}
										}
									});
						});
		
		//취소버튼
		function LectureCancelEdit(button) {
			var row = button.closest("tr"); // 클릭한 버튼이 속한 <tr> 요소 선택
			row.classList.remove("editing"); // 수정 모드 종료

			// 텍스트로 표시되는 요소를 보이지 않도록 숨깁니다.
			var spans = row.querySelectorAll('.lecture_input');
			spans.forEach(function(span) {
				span.style.display = 'none';
			});

			var inputs = row.querySelectorAll('.lecture_span');
			inputs.forEach(function(input) {
				input.style.display = 'inline-block';
			});
		}

		//강의 수정
		function updateLecture(button) {
			// 현재 행을 찾기 위해 수정 버튼의 부모 행(tr)을 가져옵니다.
			var row = button.closest('tr');

			// 텍스트로 표시되는 요소를 보이지 않도록 숨깁니다.
			var spans = row.querySelectorAll('.lecture_span');
			spans.forEach(function(span) {
				span.style.display = 'none';
			});

			var inputs = row.querySelectorAll('.lecture_input');
			inputs.forEach(function(input) {
				input.style.display = 'inline-block';
			});
			
		}
		
		//강의 저장
		function saveLecture(button){
			// 현재 행을 찾기 위해 수정 버튼의 부모 행(tr)을 가져옵니다.
			var row = button.closest('tr');
			
			//id값, nm, tm값 가져와서 비동기처리
			var lectureId = row.querySelector(".lecture_checkbox_item").value;
			var lectureNm = row.querySelector(".lecture_nm").value;
			var lectureTm = row.querySelector(".lecture_tm").value;
			
			$.ajax({
				url : '/admin/lecture/update',
				method : 'POST',
				data : {
					lectureId : lectureId,
					lectureNm : lectureNm,
					lectureTm : lectureTm
				},
				success : function(response) {
					console.log(response);
					if (response == "success") {
						alert("수정되었습니다.");
						window.location.href = "/admin/lecture/list";
					}
				}
			});
		}
		
		//취소버튼
		function SubjectCancelEdit(button) {
			var row = button.closest("tr"); // 클릭한 버튼이 속한 <tr> 요소 선택
			row.classList.remove("editing"); // 수정 모드 종료

			// 텍스트로 표시되는 요소를 보이지 않도록 숨깁니다.
			var spans = row.querySelectorAll('.subject_input')
			spans.forEach(function(span) {
				span.style.display = 'none';
			});

			var inputs = row.querySelectorAll('.subject_span')
			inputs.forEach(function(input) {
				input.style.display = 'inline-block';
			});
		}
		
		//과목 수정
		function updateSubject(button) {
			// 현재 행을 찾기 위해 수정 버튼의 부모 행(tr)을 가져옵니다.
			var row = button.closest('tr');

			// 텍스트로 표시되는 요소를 보이지 않도록 숨깁니다.
			var spans = row.querySelectorAll('.subject_span')
			spans.forEach(function(span) {
				span.style.display = 'none';
			});

			var inputs = row.querySelectorAll('.subject_input')
			inputs.forEach(function(input) {
				input.style.display = 'inline-block';
			});
		}
		
		//과목 저장
		function saveSubject(button){
			// 현재 행을 찾기 위해 수정 버튼의 부모 행(tr)을 가져옵니다.
			var row = button.closest('tr');
			
			//id값, nm, tm값 가져와서 비동기처리
			var subjectId = row.querySelector(".subject_checkbox_item").value;
			var subjectNm = row.querySelector(".subject_nm").value;
			
			$.ajax({
				url : '/admin/lecture/subject/update',
				method : 'POST',
				data : {
					subjectId : subjectId,
					subjectNm : subjectNm
				},
				success : function(response) {
					console.log(response);
					if (response == "success") {
						alert("수정되었습니다.");
						window.location.href = "/admin/lecture/list";
					}
				}
			});
		}
		
		//강사 취소
		
		//강사 수정
		function updateProfessor(button) {
			// 현재 행을 찾기 위해 수정 버튼의 부모 행(tr)을 가져옵니다.
			var row = button.closest('tr');

			// 텍스트로 표시되는 요소를 보이지 않도록 숨깁니다.
			var spans = row.querySelectorAll('.professor_span')
			spans.forEach(function(span) {
				span.style.display = 'none';
			});

			var inputs = row.querySelectorAll('.professor_input')
			inputs.forEach(function(input) {
				input.style.display = 'inline-block';
			});
		}
		
		//강사 저장
		function saveProfessor(button){
			// 현재 행을 찾기 위해 수정 버튼의 부모 행(tr)을 가져옵니다.
			var row = button.closest('tr');
			
			//id값, nm, tm값 가져와서 비동기처리
			var professorId = row.querySelector(".professor_checkbox_item").value;
			var professorNm = row.querySelector(".professor_nm").value;
			var professorTel = row.querySelector(".professor_tel").value;
			var professorEmail = row.querySelector(".professor_email").value;
			
			$.ajax({
				url : '/admin/lecture/professor/update',
				method : 'POST',
				data : {
					professorId : professorId,
					professorNm : professorNm,
					professorTel : professorTel,
					professorEmail : professorEmail
				},
				success : function(response) {
					console.log(response);
					if (response == "success") {
						alert("수정되었습니다.");
						window.location.href = "/admin/lecture/list";
					}
				}
			});
		}
	</script>
</body>
</html>