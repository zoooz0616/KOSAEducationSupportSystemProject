<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalprj.kess.repository.IManagerRepository">


	<select id="getClassList" parameterType="string" resultType="com.finalprj.kess.model.ClassVO">
	<![CDATA[
	SELECT
	    clss_id AS clssId,
	    clss_nm AS clssNm,
	    clss_start_dd AS clssStartDd,
	    clss_end_dd AS clssEndDd,
	    clss_adr AS clssAdr,
	    limit_cnt AS limitCnt,
	    cmcd.cmcd_nm AS clssCd
	FROM
	    clss JOIN cmcd on cmcd.tpcd_id||cmcd.cmcd_id = clss.clss_cd
	WHERE
	    mngr_id = #{mngrId}
	ORDER BY
    clss_id DESC
	]]>
	</select>

	<select id="getApplyCount" parameterType="string" resultType="int">
	<![CDATA[
	SELECT COUNT(stdt_id)
	FROM aply
	WHERE
	    clss_id = #{clss_id}
	]]>
	</select>
	<select id="getRgstCount" parameterType="string" resultType="int">
	<![CDATA[
	SELECT COUNT(stdt_id)
	FROM rgst
	WHERE
	    clss_id = #{clss_id}
	]]>
	</select>
	
	<select id="getClassCodeName" parameterType="string" resultType="string">
	<![CDATA[
	SELECT cmcd_nm
	FROM cmcd
	WHERE tpcd_id = 'GRP0002' AND cmcd_id = #{clss_cd}
	]]>
	</select>
	
	<select id="getClassCodeNameList" resultType="string">
	<![CDATA[
	SELECT cmcd_nm
	FROM cmcd
	WHERE tpcd_id = 'GRP0002'
	]]>
	</select>
	
	<select id="getClassDetail" resultType="com.finalprj.kess.model.ClassVO" parameterType="string">
	<![CDATA[
	SELECT
		clss_id AS clssId,
		clss_nm AS clssNm,
		aply_start_dt AS aplyStartDt,
		aply_end_dt AS aplyEndDt,
		clss_start_dd AS clssStartDd,
		clss_end_dd AS clssEndDd,
		clss_adr AS clssAdr,
		set_in_tm AS setInTm,
		set_out_tm AS setOutTm,
		limit_cnt AS limitCnt,
		substr(clss_cd,-3,3) AS clssCd,
		clss_content AS clssContent,
		mngr.mngr_Nm AS mngrId
	FROM clss JOIN mngr ON mngr.mngr_id=clss.mngr_id
	WHERE clss_id= #{classId}
	]]>
	</select>
	
	<select id="getFileIdList" resultType="string" parameterType="string">
	<![CDATA[
	select file_id from flup WHERE post_id=#{classId}
	]]>
	</select>
	
	<select id="getFile" resultType="com.finalprj.kess.model.FileVO" parameterType="string">
	<![CDATA[
	select
	file_id AS fileId,
	post_id AS postId,
	file_Nm AS fileNm,
	file_content AS fileContent,
	file_size AS fileSize,
	file_type AS fileType
	from flup WHERE file_id=#{fileId}
	]]>
	</select>
	
	<select id="getStudentList" resultType="com.finalprj.kess.model.StudentVO" parameterType="string">
	<![CDATA[
	SELECT
	    s.stdt_nm AS stdtNm,
	    s.birth_dd AS birthDd,
	    s.stdt_email AS stdtEmail,
	    s.stdt_tel AS stdtTel,
	    c.cmcd_nm AS genderCd,
	    c2.cmcd_nm AS stdtCd
	FROM rgst r
	    JOIN stdt s ON s.stdt_id=r.stdt_id
	    JOIN cmcd c ON c.tpcd_id||c.cmcd_id=s.gender_cd
	    JOIN cmcd c2 ON c2.tpcd_id||c2.cmcd_id=r.rgst_cd
	WHERE clss_id = #{classId}
	]]>
	</select>
	
	<select id="getClassNameList" resultType="com.finalprj.kess.model.ClassVO" parameterType="string">
	<![CDATA[
	SELECT
    	clss_id clssId,
    	clss_nm clssNm
	FROM clss WHERE mngr_id = #{mngrId}
	ORDER BY clss_Nm
	]]>
	</select>
	
	<select id="getClassName" resultType="string" parameterType="string">
	<![CDATA[
	SELECT
    	clss_nm
	FROM clss WHERE clss_id = #{classId}
	]]>
	</select>
	
</mapper>