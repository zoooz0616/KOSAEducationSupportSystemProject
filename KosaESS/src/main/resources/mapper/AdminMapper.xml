<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalprj.kess.repository.IAdminRepository">

	<select id="getNoticeCnt" resultType="int">
	<![CDATA[
		select count(post_id)
		from post
		where post_id like 'NOTC%'
	]]>
	</select>

	<select id="getInquiryCnt" resultType="int">
	<![CDATA[
		select count(post_id)
		from post
		where post_id like 'INQY%'
	]]>
	</select>

	<select id="getCompanyCnt" resultType="int">
	<![CDATA[
		select count(cmpy_id)
		from cmpy
		where delete_yn = 'N'
	]]>
	</select>

	<select id="getSubjectCnt" resultType="int">
	<![CDATA[
		select count(sbjt_id)
		from sbjt
		where delete_yn = 'N'
	]]>
	</select>

	<select id="getStudentCnt" resultType="int">
	<![CDATA[
		select count(stdt_id)
		from stdt
		join lgin on lgin.user_email = stdt.user_email
		where user_cd = 'USR0000001'
	]]>
	</select>

	<select id="getClassCnt" resultType="int">
	<![CDATA[
		select count(clss_id)
		from clss
		where clss_cd != 'CLS0000007'
	]]>
	</select>

	<select id="getProfesserCnt" resultType="int">
	<![CDATA[
		select count(prof_id)
		from prof
		where delete_yn = 'N'
	]]>
	</select>

	<select id="getManagerCnt" resultType="int">
	<![CDATA[
		select count(mngr_id) 
		from mngr
		join lgin on lgin.user_email = mngr.user_email
		where role_cd = 'ROL0000003' and user_cd = 'USR0000001'
	]]>
	</select>

	<select id="getWaitInquiryCnt" resultType="int">
	<![CDATA[
		select count(post_id)
		from post
		where post_id like 'INQY%' and post_cd = 'PST0000003'
	]]>
	</select>

	<select id="getWaitInquiryList"
		resultType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		select *
		from post
		where post_id like 'INQY%' and post_cd = 'PST0000003'
	]]>
	</select>

	<select id="getCompleteClassCnt" resultType="int">
	<![CDATA[
		select count(clss_id) 
		from clss
		where clss_cd = 'CLS0000005'
	]]>
	</select>

	<select id="getCompleteClassList"
		resultType="com.finalprj.kess.model.ClassVO">
	<![CDATA[
		select *
		from clss
		where clss_cd = 'CLS0000005'
	]]>
	</select>

	<select id="getClassList"
		resultType="com.finalprj.kess.model.ClassVO">
	<![CDATA[
		select *
		from clss
		left join mngr on mngr.mngr_id = clss.mngr_id
		left join cmpy on cmpy.cmpy_id = clss.cmpy_id
		join cmcd on cmcd.cmcd_id = clss.clss_cd
		where clss.delete_yn='N'
		order by clss.rgst_dt desc
	]]>
	</select>

	<select id="getClassCodeNameList" resultType="string">
	<![CDATA[
		select cmcd_nm 
		from cmcd
		where tpcd_id = 'GRP0000002'
	]]>
	</select>

	<select id="getMaxClassId" resultType="string">
	<![CDATA[
		select 'CLSS'||LPAD((max(cast(substr(clss_id,5) as number(6)))+1),6,'0')
		from clss
	]]>
	</select>

	<select id="getCompanyList"
		resultType="com.finalprj.kess.model.CompanyVO">
	<![CDATA[
		select *
		from cmpy
		where delete_yn = 'N' and cmpy_id != 'CMPY000000'
	]]>
	</select>

	<select id="getManagerList"
		resultType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
		select *
		from mngr
		join lgin on lgin.user_email = mngr.user_email
		join cmcd on cmcd.cmcd_id = lgin.user_cd
		where role_cd = 'ROL0000003'
		order by mngr_id 
	]]>
	</select>

	<select id="getLectureList"
		resultType="com.finalprj.kess.model.LectureVO">
	<![CDATA[
		select *
		from lctr
		join sbjt on sbjt.sbjt_id = lctr.sbjt_id
		join prof on prof.prof_id = lctr.prof_id
		order by lctr_id
	]]>
	</select>

	<select id="getYLectureList"
		resultType="com.finalprj.kess.model.LectureVO">
	<![CDATA[
		select *
		from lctr
		join sbjt on sbjt.sbjt_id = lctr.sbjt_id
		join prof on prof.prof_id = lctr.prof_id
		where lctr.delete_yn = 'N'
		order by lctr_id
	]]>
	</select>

	<select id="getSubject"
		resultType="com.finalprj.kess.model.SubjectVO" parameterType="string">
	<![CDATA[
		select * 
		from sbjt
		where sbjt_id = (
		select sbjt_id from lctr where lctr_id=#{lectureId}
		)
	]]>
	</select>

	<select id="getProfessor"
		resultType="com.finalprj.kess.model.ProfessorVO"
		parameterType="string">
	<![CDATA[
		select * 
		from prof
		where prof_id = (
		select prof_id from lctr where lctr_id=#{lectureId}
		)
	]]>
	</select>

	<select id="getLecture"
		resultType="com.finalprj.kess.model.LectureVO" parameterType="string">
	<![CDATA[
		select * 
		from lctr
		where lctr_id = #{lectureId}
	]]>
	</select>

	<select id="getCommonCodeList"
		resultType="com.finalprj.kess.model.CommonCodeVO"
		parameterType="string">
	<![CDATA[
		select * 
		from cmcd
		where tpcd_id = #{tpcdId}
		order by cmcd_id
	]]>
	</select>

	<insert id="insertClassVO"
		parameterType="com.finalprj.kess.model.ClassVO">
	<![CDATA[
		insert into clss
		values(#{clssId}, #{mngrId},#{cmpyId},#{clssNm},#{clssContent},#{limitCnt},
		#{aplyStartDt},#{aplyEndDt},#{clssStartDd},#{clssEndDd},#{setInTm},#{setOutTm},#{clssCd},
		#{clssAdr},#{clssTotalTm},#{fileId},#{clssEtc},systimestamp, #{rgsterId}, null, null, 'N')		
	]]>
	</insert>

	<insert id="insertCurriculumVO"
		parameterType="com.finalprj.kess.model.CurriculumVO">
		<![CDATA[
        insert into crcl
        VALUES
        (
        #{clssId},
        #{lctrId},
        systimestamp,
        #{rgsterId},
        null,
        null,
        'N'
        )
		]]>
	</insert>

	<select id="getClass" parameterType="string"
		resultType="com.finalprj.kess.model.ClassVO">
	<![CDATA[
		select *
		from clss
		left join mngr on mngr.mngr_id = clss.mngr_id
		left join cmpy on cmpy.cmpy_id = clss.cmpy_id
		join cmcd on cmcd.cmcd_id = clss.clss_cd
		where clss_id = #{clssId}
	]]>
	</select>

	<select id="getCurriculumList" parameterType="string"
		resultType="com.finalprj.kess.model.CurriculumVO">
	<![CDATA[
		select *
		from crcl
		where clss_id = #{clssId}
	]]>
	</select>

	<select id="getCurriculumDetail" parameterType="string"
		resultType="com.finalprj.kess.dto.CurriculumDetailDTO">
	<![CDATA[
		select lctr.lctr_id, lctr.lctr_nm, lctr.lctr_tm, sbjt.sbjt_id, sbjt.sbjt_nm, prof.prof_id, prof.prof_nm
		from lctr
		join sbjt on sbjt.sbjt_id = lctr.sbjt_id
		join prof on prof.prof_id = lctr.prof_id
		where lctr.lctr_id = #{lctrId}
	]]>
	</select>

	<update id="deleteFile">
		update flup
		set delete_yn = 'Y'
		where file_id=#{fileId} and file_sub_id
		in (
		<foreach item="subId" collection="fileSubIds" separator=",">
			#{subId}
		</foreach>
		)
	</update>

	<select id="getMaxFileSubId" parameterType="string"
		resultType="Integer">
	<![CDATA[
		select max(file_sub_id)+1
		from flup
		where file_id=#{fileId}
		]]>
	</select>

	<update id="updateClassVO"
		parameterType="com.finalprj.kess.model.ClassVO">
	<![CDATA[
		update clss
		set 
			mngr_id = #{mngrId},
			cmpy_id = #{cmpyId},
			clss_nm = #{clssNm},
			clss_content = #{clssContent},
			limit_cnt = #{limitCnt},
			aply_start_dt = #{aplyStartDt},
			aply_end_dt = #{aplyEndDt},
			clss_start_dd = #{clssStartDd},
			clss_end_dd = #{clssEndDd},
			set_in_tm = #{setInTm},
			set_out_tm = #{setOutTm},
			clss_cd = #{clssCd},
			clss_adr = #{clssAdr},
			clss_total_tm = #{clssTotalTm},
			clss_etc = #{clssEtc},
			updt_dt = systimestamp,
			updter_id = #{updterId}
		where clss_id=#{clssId}
	]]>
	</update>

	<delete id="deleteCurriculum" parameterType="string">
	<![CDATA[
		delete from crcl
		where clss_id=#{clssId}
	]]>
	</delete>

	<select id="getApplyDetailDTOList" parameterType="string"
		resultType="com.finalprj.kess.dto.ApplyDetailDTO">
	<![CDATA[
		select *
		from aply
		join stdt on stdt.stdt_id = aply.stdt_id
		join cmcd on cmcd.cmcd_id = aply.aply_cd
		join flup on flup.file_id = aply.file_id
		where clss_id = #{clssId} and aply_cd != 'APL0000001'
	]]>
	</select>

	<update id="updateAplyPass" parameterType="java.util.List">
		<foreach collection="aplyIds" item="item" open="DECLARE BEGIN"
			separator=";" close="; END;">
			update aply
			set
			aply_cd = 'APL0000003',
			updt_dt =
			SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where aply_id = #{item}
		</foreach>
	</update>

	<update id="updateAplyFail" parameterType="java.util.List">
		<foreach collection="aplyIds" item="item" open="DECLARE BEGIN"
			separator=";" close="; END;">
			update aply
			set
			aply_cd = 'APL0000004',
			updt_dt =
			SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where aply_id = #{item}
		</foreach>
	</update>

	<update id="deleteClass" parameterType="java.util.List">
		<foreach collection="clssIds" item="item" open="DECLARE BEGIN"
			separator=";" close="; END;">
			update clss
			set
			delete_yn = 'Y',
			updt_dt =
			SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where clss_id = #{item}
		</foreach>
	</update>

	<select id="getSearchClassVOList"
		resultType="com.finalprj.kess.model.ClassVO" parameterType="hashmap">
	<![CDATA[
	SELECT *
	FROM
	    clss
	left join cmcd on cmcd.cmcd_id = clss.clss_cd
	WHERE
        clss_nm LIKE CONCAT(#{className}, '%')
        AND clss_cd IN
    ]]>
		<foreach collection="status" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	<![CDATA[
        AND ((aply_start_dt >= #{aplyStartDt} AND aply_end_dt <= #{aplyEndDt}) or aply_start_dt is null or aply_end_dt is null)
        AND ((clss_start_dd >= #{classStartDd} AND clss_end_dd <= #{classEndDd}) or clss_start_dd is null or clss_end_dd is null)
	ORDER BY
		clss_id
	]]>
	</select>

	<select id="getProfessorList"
		resultType="com.finalprj.kess.model.ProfessorVO">
	<![CDATA[
		select *
		from prof
		order by prof_id
	]]>
	</select>

	<select id="getSubjectList"
		resultType="com.finalprj.kess.model.SubjectVO">
	<![CDATA[
		select *
		from sbjt
		order by sbjt_id
	]]>
	</select>

	<select id="getSubjectNmCnt" parameterType="string"
		resultType="int">
	<![CDATA[
	select count(sbjt_id)
	from sbjt
	where REPLACE(UPPER(sbjt_nm), ' ', '') = REPLACE(UPPER(#{sbjtNm}), ' ', '')
		and delete_yn='N'
	]]>
	</select>

	<select id="getMaxSubjectId" resultType="string">
	<![CDATA[
		select 'SBJT'||LPAD((max(cast(substr(sbjt_id,5) as number(6)))+1),6,'0')
		from sbjt
	]]>
	</select>

	<insert id="insertSubjectVO"
		parameterType="com.finalprj.kess.model.SubjectVO">
	<![CDATA[
	insert into sbjt
	values (#{sbjtId}, #{sbjtNm}, systimestamp, 'MNGR000001', null, null, 'N')
	]]>
	</insert>

	<select id="getProfTelCnt" parameterType="string"
		resultType="int">
	<![CDATA[
	select count(prof_id)
	from prof
	where prof_tel = #{profTel}
	]]>
	</select>

	<select id="getMaxProfId" resultType="string">
	<![CDATA[
		select 'PROF'||LPAD((max(cast(substr(prof_id,5) as number(6)))+1),6,'0')
		from prof
	]]>
	</select>

	<insert id="insertProfessorVO"
		parameterType="com.finalprj.kess.model.ProfessorVO">
	<![CDATA[
	insert into prof
	values (#{profId}, #{profNm}, #{profTel}, #{profEmail}, systimestamp, 'MNGR000001', null, null, 'N')
	]]>
	</insert>

	<select id="getLctrNmCnt" parameterType="string"
		resultType="int">
	<![CDATA[
	select count(lctr_id)
	from lctr
	where REPLACE(UPPER(lctr_nm), ' ', '')= REPLACE(UPPER(#{lctrNm}), ' ', '')
	]]>
	</select>

	<select id="getMaxLectureId" resultType="string">
	<![CDATA[
		select 'LCTR'||LPAD((max(cast(substr(lctr_id,5) as number(6)))+1),6,'0')
		from lctr
	]]>
	</select>

	<insert id="insertLectureVO"
		parameterType="com.finalprj.kess.model.LectureVO">
	<![CDATA[
	insert into lctr
	values (#{lctrId}, #{sbjtId}, #{profId}, #{lctrNm}, #{lctrTm}, null, systimestamp, 'MNGR000001', null, null, 'N')
	]]>
	</insert>

	<update id="deleteLecture" parameterType="java.util.List">
		<foreach collection="lectureIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update lctr
			set
			delete_yn =
			'Y',
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where lctr_id =
			#{item}
		</foreach>
	</update>

	<update id="deleteSubject" parameterType="java.util.List">
		<foreach collection="selectedSubjectIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update sbjt
			set
			delete_yn =
			'Y',
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where sbjt_id =
			#{item}
		</foreach>
	</update>

	<update id="deleteProfessor" parameterType="java.util.List">
		<foreach collection="selectedProfessorIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update prof
			set
			delete_yn =
			'Y',
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where prof_id =
			#{item}
		</foreach>
	</update>

	<select id="getNoticeList"
		resultType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		select *
		from post
		join cmcd on cmcd.cmcd_id = post.post_cd
		where post.post_id like 'NOTC%' and post.delete_yn='N'
		order by post_id desc
	]]>
	</select>

	<select id="getInquiryList"
		resultType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		select *
		from post
		join cmcd on cmcd.cmcd_id = post.post_cd
		where post_id like 'INQY%' and delete_yn='N'
		order by post_id desc
		]]>
	</select>

	<select id="getNoticeCommonCodeList"
		resultType="com.finalprj.kess.model.CommonCodeVO"
		parameterType="string">
	<![CDATA[
		select * 
		from cmcd
		where tpcd_id = #{tpcdId} and cmcd_id in ('PST0000001', 'PST0000002')
	]]>
	</select>

	<select id="getInquriyCommonCodeList"
		resultType="com.finalprj.kess.model.CommonCodeVO"
		parameterType="string">
	<![CDATA[
		select * 
		from cmcd
		where tpcd_id = #{tpcdId} and cmcd_id in ('PST0000003', 'PST0000004')
	]]>
	</select>

	<update id="deleteAllNotice" parameterType="java.util.List">
		<foreach collection="selectedNoticeIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update post
			set
			delete_yn =
			'Y',
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where post_id =
			#{item}
		</foreach>
	</update>

	<select id="getGroupCodeList"
		resultType="com.finalprj.kess.model.CommonCodeVO">
	<![CDATA[
	select *
	from cmcd
	where cmcd_id like 'GRP%'
	order by cmcd_id
	]]>
	</select>

	<select id="getMaxNoticeId" resultType="string">
	<![CDATA[
		select 'NOTC'||LPAD((max(cast(substr(post_id,5) as number(6)))+1),6,'0')
		from post
		where post_id like 'NOTC%'
	]]>
	</select>

	<insert id="insertNoticeVO"
		parameterType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		insert into post
		values(#{postId}, null, #{postTitle}, #{postContent},0, 'PST0000001', #{fileId}, systimestamp, #{rgsterId}, null, null, 'N')
	]]>
	</insert>

	<select id="getPostVO" parameterType="string"
		resultType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		select *
		from post
		join cmcd on cmcd.cmcd_id = post.post_cd
		where post_id = #{postId}
	]]>
	</select>

	<update id="deleteAllInquiry" parameterType="java.util.List">
		<foreach collection="selectedInquiryIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update post
			set
			delete_yn =
			'Y',
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where post_id =
			#{item}
		</foreach>
	</update>

	<update id="updateNoticeVO"
		parameterType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		update post
		set post_title = #{postTitle},
			post_content = #{postContent},
			file_id = #{fileId},
			updt_dt = systimestamp,
			updter_id = 'MNGR000001'
		where post_id=#{postId}
	]]>
	</update>

	<select id="getSearchPostList"
		resultType="com.finalprj.kess.model.PostVO"> 
	<![CDATA[
		select *
		from post
		join cmcd on cmcd.cmcd_id = post.post_cd
		where 
			delete_yn='N'
			and post_cd in
	]]>
		<foreach collection="postStatusList" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
		<choose>
			<when test="searchInputCategory == 'post_title'">
				AND post_title LIKE '%'||#{searchInput}||'%'
			</when>
			<when test="searchInputCategory == 'post_content'">
				AND post_content LIKE '%'||#{searchInput}||'%'
			</when>
		</choose>
		and post_id not like 'RPLY%'
		order by post_id desc
	</select>

	<select id="getReplyList" parameterType="string"
		resultType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		select *
		from post
		where master_id =#{postId}
		order by rgst_dt
	]]>
	</select>

	<select id="getMaxReplyId" resultType="string">
	<![CDATA[
		select 'RPLY'||LPAD((max(cast(substr(post_id,5) as number(6)))+1),6,'0')
		from post
		where post_id like 'RPLY%'
	]]>
	</select>

	<insert id="insertReplyVO"
		parameterType="com.finalprj.kess.model.PostVO">
	<![CDATA[
		insert into post
		values(#{postId}, #{masterId}, #{postTitle}, #{postContent}, 0, 'PST0000001', null, systimestamp, #{rgsterId}, null, null, 'N')
	]]>
	</insert>

	<update id="updateInquiryStatus" parameterType="string">
	<![CDATA[
		update post
		set post_cd = 'PST0000004'
		where post_id = #{postId}
	]]>
	</update>

	<select id="getMaxManagerId" resultType="string">
	<![CDATA[
		select 'MNGR'||LPAD((max(cast(substr(mngr_id,5) as number(6)))+1),6,'0')
		from mngr
	]]>
	</select>

	<insert id="insertLgin"
		parameterType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
	insert into lgin
	values(#{userEmail}, #{userPwd}, null, 'ROL0000003', 'USR0000001')
	]]>
	</insert>

	<insert id="insertManager"
		parameterType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
	insert into mngr
	values(#{mngrId}, #{userEmail}, #{mngrNm}, #{mngrTel}, systimestamp, 'MNGR000001', null, null)
	]]>
	</insert>

	<select id="getSearchManagerList" parameterType="string"
		resultType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
		select * 
		from mngr
		join lgin on lgin.user_email = mngr.user_email
		join cmcd on cmcd.cmcd_id = lgin.user_cd
		where mngr.user_email like #{mngrEmail}||'%'
			and mngr.mngr_nm like #{mngrNm}||'%'
			and lgin.role_cd = 'ROL0000003'
		order by mngr_id
	]]>
	</select>

	<update id="deleteLgin" parameterType="java.util.List">
		<foreach collection="selectedManagerIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update lgin
			set
			user_cd =
			'USR0000003'
			where user_email = (select user_email from mngr where
			mngr_id = #{item})
		</foreach>
	</update>

	<update id="deleteManagerList" parameterType="java.util.List">
		<foreach collection="selectedManagerIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update mngr
			set
			updt_dt =
			SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where mngr_id = #{item}
		</foreach>
	</update>

	<select id="getManager" parameterType="string"
		resultType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
	select * 
	from mngr
	join lgin on lgin.user_email = mngr.user_email
	where mngr.mngr_id = #{mngrId}
	]]>
	</select>

	<update id="updateLgin"
		parameterType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
	update lgin
	set user_cd = #{userCd}
	where user_email=(select user_email from mngr where mngr_id = #{mngrId})
	]]>
	</update>

	<update id="updateManager"
		parameterType="com.finalprj.kess.model.ManagerVO">
	<![CDATA[
	update mngr
	set 
		mngr_nm = #{mngrNm},
		mngr_tel = #{mngrTel}
	where mngr_id = #{mngrId}
	]]>
	</update>

	<select id="getYSubjectList"
		resultType="com.finalprj.kess.model.SubjectVO">
	<![CDATA[
	select *
	from sbjt
	where delete_yn='N'
	order by sbjt_nm
	]]>
	</select>

	<select id="getYProfessorList"
		resultType="com.finalprj.kess.model.ProfessorVO">
	<![CDATA[
	select *
	from prof
	where delete_yn='N'
	order by prof_nm
	]]>
	</select>

	<update id="updateLecture"
		parameterType="com.finalprj.kess.model.LectureVO">
	<![CDATA[
	 update lctr
	 set
	 	lctr_nm = #{lctrNm},
	 	lctr_tm = #{lctrTm},
	 	updt_dt = systimestamp,
	 	updter_id = 'MNGR000001'
	 where lctr_id = #{lctrId}
	]]>
	</update>

	<select id="getSubjectVO" parameterType="string"
		resultType="com.finalprj.kess.model.SubjectVO">
	<![CDATA[
		select *
		from sbjt
		where sbjt_id = #{subjectId}
	]]>
	</select>

	<update id="updateSubject"
		parameterType="com.finalprj.kess.model.SubjectVO">
	<![CDATA[
	update sbjt
	set
		sbjt_nm = #{sbjtNm},
		updt_dt = systimestamp,
		updter_id= 'MNGR000001'
	where sbjt_id = #{sbjtId}
	]]>
	</update>

	<select id="getProfessorVO" parameterType="string"
		resultType="com.finalprj.kess.model.ProfessorVO">
	<![CDATA[
	select *
	from prof
	where prof_id = #{profId}
	]]>
	</select>

	<update id="updateProfessor"
		parameterType="com.finalprj.kess.model.ProfessorVO">
	<![CDATA[
	update prof
	set 
		prof_nm = #{profNm},
		prof_tel = #{profTel},
		prof_email = #{profEmail}
	where prof_id = #{profId}
	]]>
	</update>

	<select id="getMaxCompanyId" resultType="string">
	<![CDATA[
		select 'CMPY'||LPAD((max(cast(substr(cmpy_id,5) as number(6)))+1),6,'0')
		from cmpy
	]]>
	</select>

	<insert id="insertCompanyVO"
		parameterType="com.finalprj.kess.model.CompanyVO">
	<![CDATA[
		insert into cmpy
		values(#{cmpyId}, #{cmpyNm}, #{cmpyTel}, #{cmpyAdr}, #{fileId}, systimestamp, 'MNGR000001', null, null, 'N')
	]]>
	</insert>

	<select id="getCompanyVO" parameterType="string"
		resultType="com.finalprj.kess.model.CompanyVO">
	<![CDATA[
	select *
	from cmpy
	where cmpy_id = #{cmpyId}
	]]>
	</select>

	<update id="deleteCompany" parameterType="java.util.List">
		<foreach collection="selectedCompanyIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update cmpy
			set
			delete_yn =
			'Y',
			updt_dt =
			SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where cmpy_id =
			#{item}
		</foreach>
	</update>

	<select id="getTpcdIdCnt" parameterType="string"
		resultType="int">
	<![CDATA[
		select COALESCE(COUNT(cmcd_id), 0)
		from cmcd
		where cmcd_id like 'GRP%' and tpcd_id = #{tpcdId}
	]]>
	</select>

	<select id="getMaxGroupCodeId" resultType="string">
	<![CDATA[
		select 'GRP'||LPAD((max(cast(substr(cmcd_id,4) as number(7)))+1),7,'0')
		from cmcd
		where cmcd_id like 'GRP%'
	]]>
	</select>

	<insert id="insertGroupCode"
		parameterType="com.finalprj.kess.model.CommonCodeVO">
	<![CDATA[
		insert into cmcd
		values(#{cmcdId}, #{tpcdId}, #{cmcdNm}, 'Y', systimestamp, 'MNGR000001', null, null)
	]]>
	</insert>

	<update id="deleteGroupCode" parameterType="java.util.List">
		<foreach collection="selectedGroupCodeIds" item="item"
			open="DECLARE BEGIN" separator=";" close="; END;">
			update cmcd
			set
			use_yn = 'N',
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
			where cmcd_id =
			#{item}
		</foreach>
	</update>

	<update id="updateGroupCode" parameterType="string">
	<![CDATA[
		update cmcd
		set 
			cmcd_nm = #{cmcdNm},
			updt_dt = SYSTIMESTAMP,
			updter_id = 'MNGR000001'
		where cmcd_id = #{cmcdId}
	]]>
	</update>

	<select id="getDetailCodeList" parameterType="string"
		resultType="com.finalprj.kess.model.CommonCodeVO">
	<![CDATA[
		select *
		from cmcd
		where tpcd_id = #{cmcdId}
		order by cmcd_id
	]]>
	</select>

	<select id="getGroupCodeId" parameterType="string"
		resultType="string">
	<![CDATA[
	select tpcd_id
	from cmcd
	where cmcd_id = #{cmcdId}
	]]>
	</select>

	<select id="getDetailCodeNmCnt" parameterType="string"
		resultType="int">
	<![CDATA[
	select COALESCE(COUNT(cmcd_id), 0)
	from cmcd
	where tpcd_id = #{cmcdId} and cmcd_nm =#{cmcdNm}
	]]>
	</select>

	<select id="getMaxDetailCodeId" parameterType="string"
		resultType="string">
	<![CDATA[
		select tpcd_id|| (select LPAD((COALESCE(max(cast(substr(d.cmcd_id,4) as number(7))),0)+1),7,'0')
			from cmcd d
			join cmcd g on g.cmcd_id = d.tpcd_id
			where d.tpcd_id = #{cmcdId})
    	from cmcd where cmcd_id=#{cmcdId}
	]]>
	</select>

	<insert id="insertDetailcode"
		parameterType="com.finalprj.kess.model.CommonCodeVO">
	<![CDATA[
	insert into cmcd
	values(#{cmcdId}, #{tpcdId}, #{cmcdNm}, 'Y', systimestamp, 'MNGR000001', null, null)
	]]>
	</insert>


	<update id="updateDetailCode" parameterType="string">
	<![CDATA[
	update cmcd
	set
		cmcd_nm = #{cmcdNm},
		use_yn = #{useYn},
		updt_dt = systimestamp,
		updter_id ='MNGR000001'
	where cmcd_id = #{cmcdId}
	]]>
	</update>

	<select id="getStudentEmailByAplyId" parameterType="string"
		resultType="string">
		select user_email from stdt
		where stdt_id = (select stdt_id from aply where aply_id=#{aplyId})
	</select>
	
	<select id="getClssNmByAplyId" parameterType="string"
		resultType="string">
		select clss_nm
		from clss
		where clss_id = (select clss_id from aply where aply_id=#{aplyId})
	</select>






















	<select id="getWaitClassCnt" resultType="int">
	<![CDATA[
		select count(clss_id) as "waitClassCnt"
		from clss
		where clss_cd=
		(select tpcd_id||cmcd_id
		from cmcd
		where cmcd_nm='접수중')
	]]>
	</select>

	<select id="getClassSearch" parameterType="string"
		resultType="string">
	<![CDATA[
		SELECT clss_nm
		FROM (
    		SELECT clss_nm
    		FROM clss
   			WHERE clss_nm LIKE CONCAT(#{term}, '%')
		) WHERE ROWNUM <= 10
	]]>
	</select>
</mapper>